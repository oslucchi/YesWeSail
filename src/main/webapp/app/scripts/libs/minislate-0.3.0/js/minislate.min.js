/*! Minislate - v0.3.0 - 2014-11-28T10:22:56Z - Olivier Meunier and contributors. */

!function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define([],a);else{var b;"undefined"!=typeof window?b=window:"undefined"!=typeof global?b=global:"undefined"!=typeof self&&(b=self),b.Minislate=a()}}(function(){return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);throw new Error("Cannot find module '"+g+"'")}var j=c[g]={exports:{}};b[g][0].call(j.exports,function(a){var c=b[g][1][a];return e(c?c:a)},j,j.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){var d=a("./util"),e=d.Class,f=d.extend,g=e(Object,{init:function(){this.controls={}},addControl:function(){throw new Error("Not implemented")},removeControl:function(a){this.controls[a]&&delete this.controls[a]}}),h=e(Object,{defaults:{label:null,title:"",classes:"",fontAwesomeID:null},classes:[],init:function(a,b,c){this.options=f({},this.defaults,c||{}),this.toolbar=a,this.id=b,this.label=this.options.label||this.id,this.element=this._initElement(),this.setLabel(),this.element.setAttribute("title",this.options.title),this.options.classes&&this.classes.push.apply(this.classes,this.options.classes.split(/\s+/));for(var d=0;d<this.classes.length;d++)this.element.classList.add(this.toolbar._getClassName(this.classes[d]));var e=this;this.toolbar.element.addEventListener("toolbar.show",function(){e.setVisibility(),e.setHighlight()})},_initElement:function(){throw new Error("_initElement not implemented")},drawElement:function(a){return a=a||document.createElement("li"),a.appendChild(this.element),a},setLabel:function(a,b){for(a=a||this.label,b=b||this.options.fontAwesomeID;this.element.firstChild;)this.element.removeChild(this.element.firstChild);var c=document.createTextNode(a);if(this.toolbar.options.fontAwesomeEnabled&&b){var d=this.getFaElement(b),e=document.createElement("span");e.appendChild(c),d.appendChild(e),this.element.appendChild(d)}else this.element.appendChild(c)},isHighlighted:function(){return!1},isVisible:function(){return!0},setVisibility:function(a){a="undefined"!=typeof a?a:this.isVisible(),this.element.parentNode.style.display=a?"block":"none"},setHighlight:function(a){a="undefined"!=typeof a?a:this.isHighlighted();var b=this.toolbar._getClassName("highlight");a?this.element.classList.contains(b)||this.element.classList.add(b):this.element.classList.remove(b)},getFaElement:function(a){var b=document.createElement("i");return b.classList.add("fa","fa-"+a),b}}),i=e(h,{classes:["button"],init:function(a,b,c){h.prototype.init.call(this,a,b,c);var d=this;this.element.addEventListener("click",function(a){d.click(a)})},_getParentElement:function(){var a=h.prototype._getParentElement.call(this);return a.classList.add(this.toolbar._getClassName("button")),a},_initElement:function(){return document.createElement("button")},drawElement:function(){var a=document.createElement("li");return a.classList.add(this.toolbar._getClassName("button")),h.prototype.drawElement.call(this,a)},click:function(){}}),j=e(h,{defaults:f({},h.prototype.defaults,{controls:[]}),classes:["button"],closeDelay:400,init:function(a,b,c){g.prototype.init.call(this),h.prototype.init.call(this,a,b,c);for(var d,e,f,i=0;i<this.options.controls.length;i++)d=this.options.controls[i][0],e=this.options.controls[i][1],f=this.options.controls[i][2],this.addControl(d,e,f);this.container=document.createElement("ul"),this.container.classList.add(this.toolbar._getClassName("controls")),this.container.style.display="none";var j=this,k=function(){j._open()},l=function(){j._closetimer()},m=function(){j._canceltimer()};this.toolbar.element.addEventListener("toolbar.show",function(){j._close(),j.element.removeEventListener("mouseover",k),j.element.removeEventListener("mouseout",l),j.container.removeEventListener("mouseover",m),j.container.removeEventListener("mouseout",l),setTimeout(function(){j.element.addEventListener("mouseover",k),j.element.addEventListener("mouseout",l),j.container.addEventListener("mouseover",m),j.container.addEventListener("mouseout",l)},200)})},_open:function(){var a,b;for(b in this.toolbar.controls)a=this.toolbar.controls[b],a instanceof j&&(a._canceltimer(),a._close());this._canceltimer(),this.container.style.display="block"},_close:function(){this.container.style.display="none"},_closetimer:function(){var a=this;this.closeTimeout=setTimeout(function(){a._close()},this.closeDelay)},_canceltimer:function(){this.closeTimeout&&(clearTimeout(this.closeTimeout),this.closeTimeout=null)},_initElement:function(){return document.createElement("button")},isHighlighted:function(){var a,b;for(b in this.controls)if(a=this.controls[b],a.id,a.isHighlighted())return this.setLabel(a.label,a.options.fontAwesomeID),!0;return!1},drawElement:function(){var a=document.createElement("li");return a.classList.add(this.toolbar._getClassName("menu")),a=h.prototype.drawElement.call(this,a),a.appendChild(this.container),this.drawControls(),a},setLabel:function(a,b){h.prototype.setLabel.call(this,a,b),this.element.appendChild(document.createTextNode(" "));var c;this.toolbar.options.fontAwesomeEnabled?c=this.getFaElement("chevron-down"):(c=document.createElement("span"),c.classList.add(this.toolbar._getClassName("menu-arrow")),c.appendChild(document.createTextNode("↓"))),this.element.appendChild(c)},addControl:function(a,b,c){this.controls[b]=new a(this.toolbar,b,c),this.toolbar._dirty=!0},removeControl:function(a){this.controls[a]&&(g.prototype.removeControl.call(this,a),this.toolbar._dirty=!0)},drawControls:function(){for(var a,b,c;this.container.firstChild;)this.container.removeChild(this.container.firstChild);for(b in this.controls)if(a=this.controls[b],c=a.drawElement(),a.setLabel(),this.container.appendChild(c),a.options.title){var d=document.createElement("em"),e=document.createTextNode(" - "+a.options.title);d.appendChild(e),c.firstChild.appendChild(d)}}}),k=e(Object,{init:function(a){this.control=a,this.toolbar=a.toolbar,this.element=a.toolbar.dialog},addTextField:function(a,b){var c={size:30,enter:null,escape:null};b=f({},c,b||{});var d=document.createElement("input"),e=document.createElement("label");return e.appendChild(document.createTextNode(a)),d.setAttribute("size",b.size),d.setAttribute("type","text"),e.appendChild(d),this.element.appendChild(e),(b.enter||b.escape)&&d.addEventListener("keyup",function(a){b.escape&&27===a.which?b.escape.call(d,a):b.enter&&13===a.which&&b.enter.call(d,a)}),d},addButton:function(a,b){var c={click:null,fontAwesomeID:null};b=f({},c,b||{});var d=document.createElement("button");if(d.appendChild(document.createTextNode(a)),this.element.appendChild(document.createTextNode(" ")),this.element.appendChild(d),this.element.appendChild(document.createTextNode(" ")),b.click&&"function"==typeof b.click&&d.addEventListener("click",b.click),b.fontAwesomeID&&this.toolbar.options.fontAwesomeEnabled){d.removeChild(d.firstChild),d.setAttribute("title",a);var e=h.prototype.getFaElement.call(null,b.fontAwesomeID);d.appendChild(e)}return d}});c.ControlsMixin=g,c.BaseControl=h,c.Button=i,c.Menu=j,c.Dialog=k},{"./util":9}],2:[function(a,b,c){var d=a("../util"),e=a("../controls"),f=a("../../vendor/rangy/core").api,g=d.Class,h=d.extend,i=d._,j=e.Button,k=g(j,{tagList:[],tag:null,command:"formatblock",defaults:h({},j.prototype.defaults),init:function(){j.prototype.init.apply(this,arguments),this.BLOCK_NODES=i.filter(this.toolbar.editor.BLOCK_NODES,function(a){return-1===["ul","ol"].indexOf(a.toLowerCase())})},isHighlighted:function(){return this.toolbar.editor.filterTopNodeNames.apply(this.toolbar.editor,this.tagList).length>0},click:function(){var a,b=this.toolbar.editor;"formatblock"===this.command?(this.isHighlighted()||(a=b.filterTopNodeNames.apply(b,this.BLOCK_NODES),a.length>0&&b.setRange(a[0])),this.toolbar.editor.exec(this.command,"<"+this.tag+">")):this.toolbar.editor.exec(this.command),this.toolbar.editor.showToolbar()}});c.Block=k,c.Paragraph=g(k,{tagList:["p"],tag:"p",command:"formatblock",defaults:h({},k.prototype.defaults,{label:"¶",title:"Paragraph"})});for(var l=1;6>=l;l++){var m=g(k,{tagList:["h"+l],tag:"h"+l,defaults:h({},k.prototype.defaults,{label:"H"+l,title:"Title level "+l})});c["H"+l]=m}c.Preformated=g(k,{tagList:["pre"],tag:"pre",defaults:h({},k.prototype.defaults,{label:"<>",title:"Code",fontAwesomeID:"code",tabReplacement:"    "}),init:function(){k.prototype.init.apply(this,arguments);var a=this,b=this.toolbar.editor;b.on("keydown",function(c){9!==c.which||c.ctrlKey||c.metaKey||c.shiftKey||b.filterTopNodeNames("pre").length>0&&(c.preventDefault(),b.exec("insertHtml",a.options.tabReplacement))})},click:function(){k.prototype.click.call(this);var a=this.toolbar.editor,b=a.getEnclosingNode(),c=[].slice.call(b.getElementsByTagName("br"));i.each(c,function(a){a.parentNode.insertBefore(document.createTextNode("\n"),a),a.parentNode.removeChild(a)})}});var n=g(k,{init:function(){k.prototype.init.apply(this,arguments);var a=this,b=this.toolbar.editor;b.on("keydown",function(c){if(9===c.which&&!c.ctrlKey&&!c.metaKey){var d=b.filterTopNodeNames("ul","ol");if(0===d.length||d[0].nodeName.toLowerCase()!==a.tag)return;c.preventDefault(),b.exec(c.shiftKey?"outdent":"indent")}})},click:function(){var a=this.toolbar.editor,b=a.filterTopNodeNames("ul","ol");if(b.length>0){if(b[0].nodeName.toLowerCase()===this.tag)return;var c=b[0],d=f.saveSelection(),e=document.createElement(this.tag);c.parentNode.insertBefore(e,c),i.each([].slice.call(c.childNodes),function(a){e.appendChild(a)}),c.parentNode.removeChild(c),f.restoreSelection(d),f.removeMarkers(d),a.showToolbar()}else k.prototype.click.call(this)}});c.UnorderedList=g(n,{tagList:["ul"],tag:"ul",command:"insertunorderedlist",defaults:h({},n.prototype.defaults,{label:"UL",title:"Unordered list",fontAwesomeID:"list-ul"})}),c.OrderedList=g(n,{tagList:["ol"],tag:"ol",command:"insertorderedlist",defaults:h({},n.prototype.defaults,{label:"OL",title:"Ordered list",fontAwesomeID:"list-ol"})}),c.Blockquote=g(k,{tagList:["blockquote"],defaults:h({},k.prototype.defaults,{label:"Quote",title:"Quote",fontAwesomeID:"quote-right"}),init:function(){k.prototype.init.apply(this,arguments);var a=this,b=this.toolbar.editor;b.on("keyup",function(a){if(13===a.which&&!a.ctrlKey&&!a.metaKey&&!a.shiftKey){var c=b.filterTopNodeNames("blockquote");if(0===c.length||!b.getSelection().isCollapsed)return;var d=c[0];if(c=b.filterTopNodeNames("p"),0===c.length)return;c=c[0],c.previousSibling&&""===c.previousSibling.textContent&&(c.previousSibling.parentNode.removeChild(c.previousSibling),d.parentNode.insertBefore(c,d.nextSibling),b.setRange(c),b.getSelection().collapse(c))}}),b.on("keydown",function(c){if(9===c.which&&!c.ctrlKey&&!c.metaKey){var d=b.filterTopNodeNames("blockquote");if(0===d.length)return;c.preventDefault(),c.shiftKey?a.removeBlockquote():a.insertBlockquote()}})},click:function(){var a=this.toolbar.editor,b=a.getSelection();b.isCollapsed&&0===a.getTopNodes().length||(a.filterTopNodeNames("blockquote").length>0?this.removeBlockquote():this.insertBlockquote(),a.showToolbar())},insertBlockquote:function(){var a=this.toolbar.editor,b=a.filterTopNodeNames.apply(a,a.BLOCK_NODES),c=b.length>0?b[0]:null,d=a.getSurroundingNodes(function(b){return-1!==a.BLOCK_NODES.indexOf(b.nodeName.toUpperCase())});b=d.length>0?d:c?[c]:a.getSurroundingNodes(),a.setRange(b[0],b[b.length-1]),b=a.getSurroundingNodes();var e=document.createElement("blockquote");b[0].parentNode.insertBefore(e,b[0]),i.each(b,e.appendChild,e),a.setRange(e)},removeBlockquote:function(){var a=this.toolbar.editor.filterTopNodeNames("blockquote"),b=f.saveSelection();f.dom.replaceNodeByContents(a[0]),f.restoreSelection(b),f.removeMarkers(b)}})},{"../../vendor/rangy/core":11,"../controls":1,"../util":9}],3:[function(a,b,c){var d=a("../util"),e=a("../controls"),f=a("../../vendor/rangy/core").api,g=d.Class,h=d.extend,i=d._,j=e.Button,k=e.Dialog,l=g(j,{tagList:[],command:null,isHighlighted:function(){return this.toolbar.editor.filterTopNodeNames.apply(this.toolbar.editor,this.tagList).length>0},isVisible:function(){return!this.toolbar.editor.getSelection().isCollapsed||this.isHighlighted()},click:function(){var a=this.toolbar.editor;if(a.getSelection().isCollapsed){var b=a.filterTopNodeNames.apply(a,this.tagList);if(0===b.length)return;b=b[0],a.setRange(b)}a.exec(this.command),a.showToolbar()}});c.Inline=l,c.Bold=g(l,{defaults:h({},l.prototype.defaults,{label:"B",title:"Bold",fontAwesomeID:"bold"}),tagList:["b","strong"],command:"bold",init:function(){l.prototype.init.apply(this,arguments);var a=this,b=this.toolbar.editor;b.on("keydown",function(b){66===b.which&&(b.ctrlKey||b.metaKey)&&(b.preventDefault(),a.click())})}}),c.Italic=g(l,{defaults:h({},l.prototype.defaults,{label:"I",title:"Italic",fontAwesomeID:"italic"}),tagList:["i","em"],command:"italic",init:function(){l.prototype.init.apply(this,arguments);var a=this,b=this.toolbar.editor;b.on("keydown",function(b){73===b.which&&(b.ctrlKey||b.metaKey)&&(b.preventDefault(),a.click())})}}),c.Underline=g(l,{defaults:h({},l.prototype.defaults,{label:"U",title:"Underline",fontAwesomeID:"underline"}),tagList:["u","ins"],command:"underline"}),c.StrikeThrough=g(l,{defaults:h({},l.prototype.defaults,{label:"S",title:"Strike-Through",fontAwesomeID:"strikethrough"}),tagList:["strike","del"],command:"strikeThrough"});var m=g(k,{show:function(a){var b=this.control,c=this.toolbar.editor,d=f.saveSelection();c.showDialog(function(){e.focus()});var e=this.addTextField("URL: ",{escape:function(){c.restoreSelection(d)},enter:function(e){c.restoreSelection(d),b.saveLink(a,e.target.value)}});this.addButton("Save",{fontAwesomeID:"check",click:function(f){f.stopImmediatePropagation(),c.restoreSelection(d),b.saveLink(a,e.value)}}),a&&(e.value=a.getAttribute("href"),this.addButton("Remove",{fontAwesomeID:"chain-broken",click:function(e){e.stopImmediatePropagation(),c.restoreSelection(d),b.saveLink(a,null)}}))}});c.Link=g(j,{defaults:h({},j.prototype.defaults,{label:"#",base_title:"Link",title:"",fontAwesomeID:"link"}),init:function(){j.prototype.init.apply(this,arguments);var a=this,b=this.toolbar.editor;b.on("keydown",function(b){75===b.which&&b.shiftKey&&(b.ctrlKey||b.metaKey)&&(b.preventDefault(),a.click())})},isHighlighted:function(){var a=this.options.base_title,b=this.toolbar.editor.filterTopNodeNames("a");return b.length>0&&(a+=": "+b[0].href),this.element.setAttribute("title",a),b.length>0},isVisible:function(){return!this.toolbar.editor.getSelection().isCollapsed||this.isHighlighted()},click:function(){var a=this.toolbar.editor,b=a.getSelection().isCollapsed,c=a.filterTopNodeNames("a");b&&0===c.length||(c=0===c.length?null:c[0],b&&a.setRange(c),new m(this).show(c))},saveLink:function(a,b){var c=this.toolbar.editor,d=c.getRange();if(a)if(b)a.setAttribute("href",b),c.setRange(a);else{var e=f.saveSelection();f.dom.replaceNodeByContents(a,!0),f.restoreSelection(e),f.removeMarkers(e)}else if(b){a=document.createElement("a"),a.setAttribute("href",b);var g=d.cloneContents();i.each(g.childNodes,function(b){a.appendChild(b.cloneNode(!0))}),d.deleteContents(),d.insertNode(a),c.setRange(a)}return c.showToolbar(),a}})},{"../../vendor/rangy/core":11,"../controls":1,"../util":9}],4:[function(a,b,c){var d=a("../util"),e=a("../controls"),f=a("../../vendor/rangy/core").api,g=d.Class,h=d.extend,i=e.Button,j=e.Dialog,k=g(j,{show:function(a){var b=this.control,c=this.toolbar.editor,d=f.saveSelection();c.showDialog(function(){e.focus()});var e=this.addTextField("URL: ",{escape:function(){c.restoreSelection(d)},enter:function(e){c.restoreSelection(d),b.saveImage(a,e.target.value)}});this.addButton("Save",{fontAwesomeID:"check",click:function(f){f.stopImmediatePropagation(),c.restoreSelection(d),b.saveImage(a,e.value)}}),a&&(e.value=a.getAttribute("src"))}});c.Image=g(i,{defaults:h({},i.prototype.defaults,{label:"IMG",title:"Image",fontAwesomeID:"picture-o"}),init:function(){i.prototype.init.apply(this,arguments);var a=this.toolbar.editor;a.on("click",function(b){"img"===b.target.tagName.toLowerCase()&&(a.setRange(b.target),a.showToolbar())})},isHighlighted:function(){return this.toolbar.editor.filterTopNodeNames("img").length>0},click:function(){var a=this.toolbar.editor,b=a.filterTopNodeNames("img");b=0===b.length?null:b[0],new k(this).show(b)},saveImage:function(a,b){var c=this.toolbar.editor,d=c.getRange();return a&&b?(a.setAttribute("src",b),c.setRange(a)):b&&(a=document.createElement("img"),a.setAttribute("src",b),d.deleteContents(),d.insertNode(a),c.cleanBlock(a.parentNode),c.setRange(a)),c.showToolbar(),a}}),c.Oembed=g(i,{defaults:h({},i.prototype.defaults,{label:"Embeded",title:"Embeded content",fontAwesomeID:"youtube-play"}),click:function(){window.alert("No implemented yet :)")}})},{"../../vendor/rangy/core":11,"../controls":1,"../util":9}],5:[function(a,b,c){var d=a("../vendor/rangy/core").api,e=a("./util").extend,f=a("./util").Class,g=a("./toolbar").Toolbar,h=a("./util")._,i=a("./html-cleaner").HtmlCleaner,j=f(Object,{defaults:{delay:300,diffLeft:2,diffTop:-10,classPrefix:"editor-",fontAwesomeEnabled:!0},BLOCK_NODES:"P H1 H2 H3 H4 H5 H6 UL OL PRE DL DIV NOSCRIPT BLOCKQUOTE FORM HR TABLE FIELDSET ADDRESS".split(" "),init:function(a,b){if(!window.getSelection)throw new Error("Browser features missing.");"object"==typeof a&&(this.element=a,d.initialized||d.init(),this.isActive=!0,this.isSelected=!1,this.options=e({},this.defaults,b),this._currentEditor=null,this._resizeHandler=function(a){var b=null;return function(){clearTimeout(b),b=setTimeout(function(){a.setToolbarPosition()},250)}}(this),this.initElement().initToolbar().bindSelect().bindTyping())},on:function(a,b){this.element.addEventListener(a,b)},off:function(a,b){this.element.removeEventListener(a,b)},initElement:function(){var a=this;return this.element.setAttribute("contentEditable",!0),this.element.setAttribute("data-editor-element",!0),this.on("focus",function(){a._onFocus()}),this},bindSelect:function(){var a=this,b=null,c=function(c){clearTimeout(b),b=setTimeout(function(){a._onSelect(c)},a.options.delay)};return document.addEventListener("mouseup",c),document.addEventListener("keyup",c),this},bindTyping:function(){var a=this;return this.on("keyup",function(b){var c=a.getSelection();9!==b.which&&c.isCollapsed&&c.getEnclosingNode()===a._currentEditor&&a.exec("formatBlock","p")}),this},initToolbar:function(){var a=this;return this.toolbar=new g(this,{classPrefix:this.options.classPrefix,fontAwesomeEnabled:this.options.fontAwesomeEnabled}),this.toolbar.element.addEventListener("toolbar.show",function(){a.focus()}),this.toolbar.element.addEventListener("toolbar.hide",function(){var b=a.element.querySelectorAll("span.rangySelectionBoundary");h.each(b,function(a){a.parentNode.removeChild(a)})}),this},exec:function(a,b){document.execCommand(a,!1,b)},focus:function(){this._currentEditor&&this._currentEditor.focus()},showToolbar:function(){return this.toolbar.hideDialog(),this.toolbar.show(),this.setToolbarPosition(),window.addEventListener("resize",this._resizeHandler),this},hideToolbar:function(){return window.removeEventListener("resize",this._resizeHandler),this.toolbar.hide(),this},showDialog:function(a){var b=this;return this.toolbar.showDialog(),setTimeout(function(){b.setToolbarPosition(),"function"==typeof a&&a.call(b)},20),this},setToolbarPosition:function(){var a,b=this.getSelection(),c=this.getRange(),e=b.getEnclosingNode(),f=this.toolbar.element.offsetHeight,g=this.toolbar.element.offsetWidth;if(!b.isCollapsed&&d.util.isHostMethod(c.nativeRange,"getBoundingClientRect"))a=c.nativeRange.getBoundingClientRect();else{for(;1===e.parentNode.childNodes.length;)e=e.parentNode;a=e.getBoundingClientRect()}var h=0;h=a.top<f?a.bottom-this.options.diffTop+window.pageYOffset:a.top+this.options.diffTop+window.pageYOffset-f;var i=a.left-this.options.diffLeft;this._currentEditor.offsetWidth<g+a.left&&(i=a.right-g+this.options.diffLeft),this.toolbar.move(h,i)},restoreSelection:function(a,b){b="undefined"==typeof b?!0:b,d.restoreSelection(a),d.removeMarkers(a),this.element.focus(),b&&this.showToolbar()},_onFocus:function(){this._currentEditor=this.element},_onSelect:function(a){var b=[this.element,this.toolbar.element];return d.dom.hasParents(a.target,b)?(this._currentEditor=this.element,d.dom.hasParents(a.target,[this.toolbar.element])||this.showToolbar(),void(this.isSelected||(this.isSelected=!0,9===a.which&&this.selectStart()))):void(this.isSelected&&(this.hideToolbar(),this._currentEditor=null,this.isSelected=!1))},selectStart:function(){var a=this.getSelection();if(a.isCollapsed){this.element.childNodes.length>0&&3===this.element.firstChild.nodeType&&""===this.element.firstChild.textContent.replace(/^\s*(.*?)\s*$/,"$1")&&this.element.removeChild(this.element.firstChild);var b,c;if(this.element.childNodes.length>0?(b=this.element.firstChild,c=d.dom.getNodes(b,3),c.length>0&&(b=c[0])):(b=document.createElement("p"),this.element.appendChild(b),b.appendChild(document.createTextNode("")),b=b.firstChild),3===b.nodeType){var e=d.createRange();e.setStart(b,0),this.getSelection().setSingleRange(e)}else this.setRange(b);this.showToolbar()}},getSelection:function(){return d.getSelection()},getRange:function(a){return a="undefined"==typeof a?0:a,this.getSelection().getRangeAt(0)},setRange:function(a,b){if("undefined"!=typeof a){var c=d.createRange();c.selectNodeContents(a),b&&b!==a&&c.setEndAfter(b.lastChild?b.lastChild:b),this.getSelection().setSingleRange(c)}},getEnclosingNode:function(){var a=this.getSelection();if(1!==a.rangeCount)return null;var b=a.getEnclosingNode();return b===this._currentEditor?null:b},getTopNodes:function(a){var b=this.getSelection();return 1!==b.rangeCount?[]:b.getTopNodes(this._currentEditor,a)},getSurroundingNodes:function(a){var b=this.getSelection();return 1!==b.rangeCount?[]:b.getSurroundingNodes(a)},filterTopNodeNames:function(){var a=h.map(arguments,function(a){return a.toLowerCase()});return this.getTopNodes(function(b){return-1!==a.indexOf(b.nodeName.toLowerCase())})},cleanBlock:function(a){var b=a.childNodes[a.childNodes.length-1];1===b.nodeType&&"br"===b.nodeName.toLowerCase()&&a.removeChild(b)},serialize:function(a){var b=this.element.innerHTML;if(a){var c=new i;b=c.clean(b)}return b}});c.Editor=j;var k={Menu:a("./controls").Menu,inline:a("./controls/inline"),block:a("./controls/block"),media:a("./controls/media")};c.controls=k,c.simpleEditor=f(j,{init:function(){j.prototype.init.apply(this,arguments),this.toolbar.addControl(k.Menu,"blocks",{label:"¶",title:"Blocks",controls:[[k.block.Paragraph,"p"],[k.block.H1,"h1"],[k.block.H2,"h2"],[k.block.H3,"h3"],[k.block.Preformated,"pre"]]}),this.toolbar.addControl(k.Menu,"lists",{label:"Lists",title:"Lists",fontAwesomeID:"list-ul",controls:[[k.block.UnorderedList,"ul"],[k.block.OrderedList,"ol"]]}),this.toolbar.addControl(k.block.Blockquote,"quote"),this.toolbar.addControl(k.inline.Bold,"bold"),this.toolbar.addControl(k.inline.Italic,"italic"),this.toolbar.addControl(k.inline.Underline,"underline"),this.toolbar.addControl(k.inline.StrikeThrough,"strike"),this.toolbar.addControl(k.inline.Link,"link"),this.toolbar.addControl(k.media.Image,"image"),this.toolbar.addControl(k.media.Oembed,"oembed")}})},{"../vendor/rangy/core":11,"./controls":1,"./controls/block":2,"./controls/inline":3,"./controls/media":4,"./html-cleaner":6,"./toolbar":8,"./util":9}],6:[function(a,b,c){var d=a("./util").Class,e=a("./util").extend,f=a("./util")._,g=d(Object,{defaults:{},init:function(a){this.options=e({},this.defaults,a)},formatRegexp:[[/(<[a-z][^>]*)margin\s*:[^;]*;/gm,"$1"],[/(<[a-z][^>]*)margin-bottom\s*:[^;]*;/gm,"$1"],[/(<[a-z][^>]*)margin-left\s*:[^;]*;/gm,"$1"],[/(<[a-z][^>]*)margin-right\s*:[^;]*;/gm,"$1"],[/(<[a-z][^>]*)margin-top\s*:[^;]*;/gm,"$1"],[/(<[a-z][^>]*)padding\s*:[^;]*;/gm,"$1"],[/(<[a-z][^>]*)padding-bottom\s*:[^;]*;/gm,"$1"],[/(<[a-z][^>]*)padding-left\s*:[^;]*;/gm,"$1"],[/(<[a-z][^>]*)padding-right\s*:[^;]*;/gm,"$1"],[/(<[a-z][^>]*)padding-top\s*:[^;]*;/gm,"$1"],[/(<[a-z][^>]*)font\s*:[^;]*;/gm,"$1"],[/(<[a-z][^>]*)font-family\s*:[^;]*;/gm,"$1"],[/(<[a-z][^>]*)font-size\s*:[^;]*;/gm,"$1"],[/(<[a-z][^>]*)font-style\s*:[^;]*;/gm,"$1"],[/(<[a-z][^>]*)font-variant\s*:[^;]*;/gm,"$1"],[/(<[a-z][^>]*)font-weight\s*:[^;]*;/gm,"$1"],[/(<[a-z][^>]*)color\s*:[^;]*;/gm,"$1"]],cleanRegexp:[[/<meta[\w\W]*?>/gim,""],[/<style[\w\W]*?>[\w\W]*?<\/style>/gim,""],[/<\/?font[\w\W]*?>/gim,""],[/<(\/?)(B|b|STRONG)([\s>\/])/g,"<$1strong$3"],[/<(\/?)(I|i|EM)([\s>\/])/g,"<$1em$3"],[/<IMG ([^>]*?[^\/])>/gi,"<img $1 />"],[/<INPUT ([^>]*?[^\/])>/gi,"<input $1 />"],[/<COL ([^>]*?[^\/])>/gi,"<col $1 />"],[/<AREA ([^>]*?[^\/])>/gi,"<area $1 />"],[/<PARAM ([^>]*?[^\/])>/gi,"<param $1 />"],[/<HR ([^>]*?[^\/])>/gi,"<hr $1/>"],[/<BR ([^>]*?[^\/])>/gi,"<br $1/>"],[/<(\/?)U([\s>\/])/gi,"<$1ins$2"],[/<(\/?)STRIKE([\s>\/])/gi,"<$1del$2"],[/<span style="font-weight: normal;">([\w\W]*?)<\/span>/gm,"$1"],[/<span style="font-weight: bold;">([\w\W]*?)<\/span>/gm,"<strong>$1</strong>"],[/<span style="font-style: italic;">([\w\W]*?)<\/span>/gm,"<em>$1</em>"],[/<span style="text-decoration: underline;">([\w\W]*?)<\/span>/gm,"<ins>$1</ins>"],[/<span style="text-decoration: line-through;">([\w\W]*?)<\/span>/gm,"<del>$1</del>"],[/<span style="text-decoration: underline line-through;">([\w\W]*?)<\/span>/gm,"<del><ins>$1</ins></del>"],[/<span style="(font-weight: bold; ?|font-style: italic; ?){2}">([\w\W]*?)<\/span>/gm,"<strong><em>$2</em></strong>"],[/<span style="(font-weight: bold; ?|text-decoration: underline; ?){2}">([\w\W]*?)<\/span>/gm,"<ins><strong>$2</strong></ins>"],[/<span style="(font-weight: italic; ?|text-decoration: underline; ?){2}">([\w\W]*?)<\/span>/gm,"<ins><em>$2</em></ins>"],[/<span style="(font-weight: bold; ?|text-decoration: line-through; ?){2}">([\w\W]*?)<\/span>/gm,"<del><strong>$2</strong></del>"],[/<span style="(font-weight: italic; ?|text-decoration: line-through; ?){2}">([\w\W]*?)<\/span>/gm,"<del><em>$2</em></del>"],[/<span style="(font-weight: bold; ?|font-style: italic; ?|text-decoration: underline; ?){3}">([\w\W]*?)<\/span>/gm,"<ins><strong><em>$2</em></strong></ins>"],[/<span style="(font-weight: bold; ?|font-style: italic; ?|text-decoration: line-through; ?){3}">([\w\W]*?)<\/span>/gm,"<del><strong><em>$2</em></strong></del>"],[/<span style="(font-weight: bold; ?|font-style: italic; ?|text-decoration: underline line-through; ?){3}">([\w\W]*?)<\/span>/gm,"<del><ins><strong><em>$2</em></strong></ins></del>"],[/<strong style="font-weight: normal;">([\w\W]*?)<\/strong>/gm,"$1"],[/<([a-z]+) style="font-weight: normal;">([\w\W]*?)<\/\1>/gm,"<$1>$2</$1>"],[/<([a-z]+) style="font-weight: bold;">([\w\W]*?)<\/\1>/gm,"<$1><strong>$2</strong></$1>"],[/<([a-z]+) style="font-style: italic;">([\w\W]*?)<\/\1>/gm,"<$1><em>$2</em></$1>"],[/<([a-z]+) style="text-decoration: underline;">([\w\W]*?)<\/\1>/gm,"<ins><$1>$2</$1></ins>"],[/<([a-z]+) style="text-decoration: line-through;">([\w\W]*?)<\/\1>/gm,"<del><$1>$2</$1></del>"],[/<([a-z]+) style="text-decoration: underline line-through;">([\w\W]*?)<\/\1>/gm,"<del><ins><$1>$2</$1></ins></del>"],[/<([a-z]+) style="(font-weight: bold; ?|font-style: italic; ?){2}">([\w\W]*?)<\/\1>/gm,"<$1><strong><em>$3</em></strong></$1>"],[/<([a-z]+) style="(font-weight: bold; ?|text-decoration: underline; ?){2}">([\w\W]*?)<\/\1>/gm,"<ins><$1><strong>$3</strong></$1></ins>"],[/<([a-z]+) style="(font-weight: italic; ?|text-decoration: underline; ?){2}">([\w\W]*?)<\/\1>/gm,"<ins><$1><em>$3</em></$1></ins>"],[/<([a-z]+) style="(font-weight: bold; ?|text-decoration: line-through; ?){2}">([\w\W]*?)<\/\1>/gm,"<del><$1><strong>$3</strong></$1></del>"],[/<([a-z]+) style="(font-weight: italic; ?|text-decoration: line-through; ?){2}">([\w\W]*?)<\/\1>/gm,"<del><$1><em>$3</em></$1></del>"],[/<([a-z]+) style="(font-weight: bold; ?|font-style: italic; ?|text-decoration: underline; ?){3}">([\w\W]*?)<\/\1>/gm,"<ins><$1><strong><em>$3</em></strong></$1></ins>"],[/<([a-z]+) style="(font-weight: bold; ?|font-style: italic; ?|text-decoration: line-through; ?){3}">([\w\W]*?)<\/\1>/gm,"<del><$1><strong><em>$3</em></strong></$1></del>"],[/<([a-z]+) style="(font-weight: bold; ?|font-style: italic; ?|text-decoration: underline line-through; ?){3}">([\w\W]*?)<\/\1>/gm,"<del><ins><$1><strong><em>$3</em></strong></$1></ins></del>"],[/<p><blockquote>(.*)(\n)+<\/blockquote><\/p>/i,"<blockquote>$1</blockquote>\n"],[/<\/(strong|em|ins|del|q|code)>(\s*?)<\1>/gim,"$2"],[/<(br|BR)>/g,"<br />"],[/<(hr|HR)>/g,"<hr />"],[/([^\s])\/>/g,"$1 />"],[/<br \/>\s*<\/(h1|h2|h3|h4|h5|h6|ul|ol|li|p|blockquote|div)/gi,"</$1"],[/<\/(h1|h2|h3|h4|h5|h6|ul|ol|li|p|blockquote)>([^\n\u000B\r\f])/gi,"</$1>\n$2"],[/<hr style="width: 100%; height: 2px;" \/>/g,"<hr />"],[/style="\s*?"/gim,""],[/<\s+/gim,"<"],[/\s+>/gim,">"]],removeFormat:function(a){return f.each(this.formatRegexp,function(b){a="".replace.apply(a,b)}),a},tagsoup2html:function(a){for(f.each(this.cleanRegexp,function(b){a="".replace.apply(a,b)});/(<[^\/!]>|<[^\/!][^>]*[^\/]>)\s*<\/[^>]*[^-]>/.test(a);)a=a.replace(/(<[^\/!]>|<[^\/!][^>]*[^\/]>)\s*<\/[^>]*[^-]>/g,"");a=a.replace(/<(\/?)([A-Z0-9]+)/g,function(a,b,c){return"<"+b+c.toLowerCase()});for(var b=/<[^>]+((\s+\w+\s*=\s*)([^"'][\w~@+$,%\/:.#?=&;!*()-]*))[^>]*?>/,c=function(a,b,c,d){var e=b.replace(/([\\\^\$*+[\]?{}.=!:(|)])/g,"\\$1");return a.replace(e,c+'"'+d+'"')};b.test(a);)a=a.replace(b,c);for(;/(<[^>]+style=(["'])[^>]+[\s:]+)0(pt|px)(\2|\s|;)/.test(a);)a=a.replace(/(<[^>]+style=(["'])[^>]+[\s:]+)0(pt|px)(\2|\s|;)/gi,"$10$4");return a=a.replace(/\r\n/g,"\n"),a=a.replace(/^\s+/,"").replace(/\s+$/,"")},clean:function(a){return a=this.removeFormat(a),a=this.tagsoup2html(a)}});c.HtmlCleaner=g},{"./util":9}],7:[function(a){var b=a("../vendor/rangy/core"),c=a("./util")._;b.api.createCoreModule("RangyExtensions",[],function(a){a.selectionPrototype.getBoundaryNodes=function(){var a,b,c,d;for(this.isBackwards()?(a=this.focusNode,b=this.focusOffset,c=this.anchorNode,d=this.anchorOffset):(a=this.anchorNode,b=this.anchorOffset,c=this.focusNode,d=this.focusOffset),3===a.nodeType&&a.nextSibling&&a.length===b?a=a.nextSibling:1===a.nodeType&&a.childNodes.length>b&&(a=a.childNodes[b]);a.firstChild&&1===a.firstChild.nodeType;)a=a.firstChild;for(3===c.nodeType&&c.previousSibling&&0===d?c=c.previousSibling:d>0&&1===c.nodeType&&c.childNodes.length>0&&(c=c.childNodes[d-1]);c.lastChild&&1===c.lastChild.nodeType;)c=c.lastChild;return a=a&&1!==a.nodeType?a.parentNode:a,c=c&&1!==c.nodeType?c.parentNode:c,{start:a,end:c}},a.selectionPrototype.getEnclosingNode=function(){var b,c=this.getBoundaryNodes();return b=c.start===c.end?c.start:a.dom.getCommonAncestor(c.start,c.end),a.dom.getDeepestNode(b)},a.selectionPrototype.getTopNodes=function(a,b){a=a||document.body;var d=this.getEnclosingNode(),e=[d];if(d===a)return[];for(;d.parentNode!==a;)d=d.parentNode,e.push(d);return"function"==typeof b?c.filter(e,b):e},a.selectionPrototype.getSurroundingNodes=function(b){var d,e=this.getBoundaryNodes(),f=this.getEnclosingNode(),g=!1,h=[];if(a.dom.isAncestorOf(e.start,e.end,!0))return[e.start];if(a.dom.isAncestorOf(e.end,e.start,!0))return[e.end];for(var i=0;i<f.childNodes.length&&(d=f.childNodes[i],g||(g=a.dom.isAncestorOf(d,e.start,!0)),g&&h.push(d),!a.dom.isAncestorOf(d,e.end,!0));i++);return"function"==typeof b?c.filter(h,b):h},a.dom.hasParents=function(a,b){for(;-1===[document,document.body].indexOf(a)&&null!=a;){if(-1!==b.indexOf(a))return!0;a=a.parentNode}return!1},a.dom.getDeepestNode=function(a){for(;1===a.childNodes.length&&1===a.firstChild.nodeType;)a=a.firstChild;return a},a.dom.replaceNodeByContents=function(a){var b=this.getDocument(a).createDocumentFragment();c.each(a.childNodes,function(a){b.appendChild(a.cloneNode(!0))}),a.parentNode.replaceChild(b,a)},a.dom.getNodes=function(b,c,d){var e=[];d||"undefined"!=typeof c&&b.nodeType!==c||e.push(b);
for(var f=0;f<b.childNodes.length;f++)("undefined"==typeof c||b.childNodes[f].nodeType===c)&&e.push(b.childNodes[f]),[].push.apply(e,a.dom.getNodes(b.childNodes[f],c,!0));return e}})},{"../vendor/rangy/core":11,"./util":9}],8:[function(a,b,c){var d=a("./util"),e=a("./controls"),f=e.ControlsMixin,g=d.extend,h=d.Class,i=h(Object,{defaults:{classPrefix:"",fontAwesomeEnabled:!1},init:function(a,b){f.prototype.init.call(this),this.editor=a,this.options=g({},this.defaults,b||{}),this.element=document.createElement("div"),this.container=document.createElement("ul"),this.dialog=document.createElement("div"),this.container.classList.add(this._getClassName("controls")),this.element.classList.add(this._getClassName("toolbar")),document.body.appendChild(this.element),this.dialog.classList.add(this._getClassName("dialog")),this.dialog.style.display="none",this.element.appendChild(this.container),this.element.appendChild(this.dialog),this.element.style.visibility="hidden",this._showEvt=document.createEvent("Event"),this._showEvt.initEvent("toolbar.show",!1,!0),this._hideEvt=document.createEvent("Event"),this._hideEvt.initEvent("toolbar.hide",!1,!0),this._dirty=!1},_getClassName:function(a){return this.options.classPrefix+a},click:function(a){this.element.addEventListener("click",a)},focus:function(a){this.element.addEventListener("focus",a)},hide:function(){this.element.style.visibility="hidden",this.element.dispatchEvent(this._hideEvt)},show:function(){this._dirty&&this.drawControls(),this.element.style.visibility="visible",this.element.dispatchEvent(this._showEvt)},showDialog:function(){this.emptyDialog(),this.dialog.style.display="block",this.container.style.display="none"},hideDialog:function(){this.dialog.style.display="none",this.container.style.display="block"},emptyDialog:function(){for(;this.dialog.firstChild;)this.dialog.removeChild(this.dialog.firstChild)},move:function(a,b){this.element.style.top=a+"px",this.element.style.left=b+"px"},addControl:function(a,b,c){this.controls[b]=new a(this,b,c),this._dirty=!0},removeControl:function(a){this.controls[a]&&(f.prototype.removeControl.call(this,a),this._dirty=!0)},drawControls:function(){for(var a;this.container.firstChild;)this.container.removeChild(this.container.firstChild);for(var b in this.controls)a=this.controls[b],this.container.appendChild(a.drawElement());this._dirty=!1}});c.Toolbar=i},{"./controls":1,"./util":9}],9:[function(a,b,c){var d=function(){var a=Array.prototype.slice.call(arguments),b=a.shift(),c="";("string"==typeof b||"boolean"==typeof b)&&(c=b===!0?"deep":b,b=a.shift(),"defaults"===c&&(b=d({},b),c="strict"));for(var e=0,f=a.length;f>e;e++){var g=a[e];for(var h in g)"deep"===c&&"object"==typeof g[h]&&"undefined"!=typeof b[h]?d(c,b[h],g[h]):("strict"!==c||"strict"===c&&"undefined"!=typeof b[h])&&(b[h]=g[h])}return b},e=function(a,b){var c=function(){"undefined"!=typeof this.init&&this.init.apply(this,arguments)},e=function(){};return e.prototype=a.prototype,c.prototype=new e,c.prototype.constructor=a,d(c.prototype,b),c},f={},g={},h=Array.prototype.forEach,i=Array.prototype.map,j=Array.prototype.filter;f.each=function(a,b,c){if(null==a)return a;if(h&&a.forEach===h)a.forEach(b,c);else if(a.length===+a.length){for(var d=0,e=a.length;e>d;d++)if(b.call(c,a[d],d,a)===g)return}else for(var i=f.keys(a),d=0,e=i.length;e>d;d++)if(b.call(c,a[i[d]],i[d],a)===g)return;return a},f.map=function(a,b,c){var d=[];return null==a?d:i&&a.map===i?a.map(b,c):(f.each(a,function(a,e,f){d.push(b.call(c,a,e,f))}),d)},f.filter=function(a,b,c){var d=[];return null==a?d:j&&a.filter===j?a.filter(b,c):(f.each(a,function(a,e,f){b.call(c,a,e,f)&&d.push(a)}),d)},c.extend=d,c.Class=e,c._=f},{}],10:[function(a,b,c){c.VERSION="0.3.0",c.rangy=a("./vendor/rangy/core").api,a("./vendor/rangy/dom"),a("./vendor/rangy/domrange"),a("./vendor/rangy/selectionsaverestore"),a("./vendor/rangy/wrappedrange"),a("./vendor/rangy/wrappedselection"),a("./lib/rangy-extensions"),c.extend=a("./lib/util").extend,c.Class=a("./lib/util").Class,c.HtmlCleaner=a("./lib/html-cleaner").HtmlCleaner,c.Editor=a("./lib/editor").Editor,c.controls=a("./lib/editor").controls,c.simpleEditor=a("./lib/editor").simpleEditor},{"./lib/editor":5,"./lib/html-cleaner":6,"./lib/rangy-extensions":7,"./lib/util":9,"./vendor/rangy/core":11,"./vendor/rangy/dom":12,"./vendor/rangy/domrange":13,"./vendor/rangy/selectionsaverestore":14,"./vendor/rangy/wrappedrange":15,"./vendor/rangy/wrappedselection":16}],11:[function(a,b,c){function d(a,b){var c=typeof a[b];return c==v||!(c!=u||!a[b])||"unknown"==c}function e(a,b){return!(typeof a[b]!=u||!a[b])}function f(a,b){return typeof a[b]!=w}function g(a){return function(b,c){for(var d=c.length;d--;)if(!a(b,c[d]))return!1;return!0}}function h(a){return a&&B(a,A)&&D(a,z)}function i(a){return e(a,"body")?a.body:a.getElementsByTagName("body")[0]}function j(a){e(window,"console")&&d(window.console,"log")&&window.console.log(a)}function k(a,b){b?window.alert(a):j(a)}function l(a){F.initialized=!0,F.supported=!1,k("Rangy is not supported on this page in your browser. Reason: "+a,F.config.alertOnFail)}function m(a){k("Rangy warning: "+a,F.config.alertOnWarn)}function n(a){return a.message||a.description||String(a)}function o(){if(!F.initialized){var a,b=!1,c=!1;d(document,"createRange")&&(a=document.createRange(),B(a,y)&&D(a,x)&&(b=!0),a.detach());var e=i(document);if(!e||"body"!=e.nodeName.toLowerCase())return void l("No body element found");if(e&&d(e,"createTextRange")&&(a=e.createTextRange(),h(a)&&(c=!0)),!b&&!c)return void l("Neither Range nor TextRange are available");F.initialized=!0,F.features={implementsDomRange:b,implementsTextRange:c};var f,g;for(var k in E)(f=E[k])instanceof q&&f.init(f,F);for(var m=0,o=H.length;o>m;++m)try{H[m](F)}catch(p){g="Rangy init listener threw an exception. Continuing. Detail: "+n(p),j(g)}}}function p(a){a=a||window,o();for(var b=0,c=I.length;c>b;++b)I[b](a)}function q(a,b,c){this.name=a,this.dependencies=b,this.initialized=!1,this.supported=!1,this.initializer=c}function r(a,b,c,d){var e=new q(b,c,function(a){if(!a.initialized){a.initialized=!0;try{d(F,a),a.supported=!0}catch(c){var e="Module '"+b+"' failed to load: "+n(c);j(e)}}});E[b]=e}function s(){}function t(){}var u="object",v="function",w="undefined",x=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],y=["setStart","setStartBefore","setStartAfter","setEnd","setEndBefore","setEndAfter","collapse","selectNode","selectNodeContents","compareBoundaryPoints","deleteContents","extractContents","cloneContents","insertNode","surroundContents","cloneRange","toString","detach"],z=["boundingHeight","boundingLeft","boundingTop","boundingWidth","htmlText","text"],A=["collapse","compareEndPoints","duplicate","moveToElementText","parentElement","select","setEndPoint","getBoundingClientRect"],B=g(d),C=g(e),D=g(f),E={},F={version:"1.3alpha.804",initialized:!1,supported:!0,util:{isHostMethod:d,isHostObject:e,isHostProperty:f,areHostMethods:B,areHostObjects:C,areHostProperties:D,isTextRange:h,getBody:i},features:{},modules:E,config:{alertOnFail:!0,alertOnWarn:!1,preferTextRange:!1}};F.fail=l,F.warn=m,{}.hasOwnProperty?F.util.extend=function(a,b,c){var d,e;for(var f in b)b.hasOwnProperty(f)&&(d=a[f],e=b[f],c&&null!==d&&"object"==typeof d&&null!==e&&"object"==typeof e&&F.util.extend(d,e,!0),a[f]=e);return a}:l("hasOwnProperty not supported"),function(){var a=document.createElement("div");a.appendChild(document.createElement("span"));var b,c=[].slice;try{1==c.call(a.childNodes,0)[0].nodeType&&(b=function(a){return c.call(a,0)})}catch(d){}b||(b=function(a){for(var b=[],c=0,d=a.length;d>c;++c)b[c]=a[c];return b}),F.util.toArray=b}();var G;d(document,"addEventListener")?G=function(a,b,c){a.addEventListener(b,c,!1)}:d(document,"attachEvent")?G=function(a,b,c){a.attachEvent("on"+b,c)}:l("Document does not have required addEventListener or attachEvent method"),F.util.addListener=G;var H=[];F.init=o,F.addInitListener=function(a){F.initialized?a(F):H.push(a)};var I=[];F.addCreateMissingNativeApiListener=function(a){I.push(a)},F.createMissingNativeApi=p,q.prototype={init:function(){for(var a,b,c=this.dependencies||[],d=0,e=c.length;e>d;++d){if(b=c[d],a=E[b],!(a&&a instanceof q))throw new Error("required module '"+b+"' not found");if(a.init(),!a.supported)throw new Error("required module '"+b+"' not supported")}this.initializer(this)},fail:function(a){throw this.initialized=!0,this.supported=!1,new Error("Module '"+this.name+"' failed to load: "+a)},warn:function(a){F.warn("Module "+this.name+": "+a)},deprecationNotice:function(a,b){F.warn("DEPRECATED: "+a+" in module "+this.name+"is deprecated. Please use "+b+" instead")},createError:function(a){return new Error("Error in Rangy "+this.name+" module: "+a)}},F.createModule=function(a){var b,c;2==arguments.length?(b=arguments[1],c=[]):(b=arguments[2],c=arguments[1]),r(!1,a,c,b)},F.createCoreModule=function(a,b,c){r(!0,a,b,c)},F.RangePrototype=s,F.rangePrototype=new s,F.selectionPrototype=new t,c.api=F},{}],12:[function(a){var b=a("./core");b.api.createCoreModule("DomUtil",[],function(a,b){function c(a){var b;return typeof a.namespaceURI==D||null===(b=a.namespaceURI)||"http://www.w3.org/1999/xhtml"==b}function d(a){var b=a.parentNode;return 1==b.nodeType?b:null}function e(a){for(var b=0;a=a.previousSibling;)++b;return b}function f(a){switch(a.nodeType){case 7:case 10:return 0;case 3:case 8:return a.length;default:return a.childNodes.length}}function g(a,b){var c,d=[];for(c=a;c;c=c.parentNode)d.push(c);for(c=b;c;c=c.parentNode)if(H(d,c))return c;return null}function h(a,b,c){for(var d=c?b:b.parentNode;d;){if(d===a)return!0;d=d.parentNode}return!1}function i(a,b){return h(a,b,!0)}function j(a,b,c){for(var d,e=c?a:a.parentNode;e;){if(d=e.parentNode,d===b)return e;e=d}return null}function k(a){var b=a.nodeType;return 3==b||4==b||8==b}function l(a){if(!a)return!1;var b=a.nodeType;return 3==b||8==b}function m(a,b){var c=b.nextSibling,d=b.parentNode;return c?d.insertBefore(a,c):d.appendChild(a),a}function n(a,b,c){var d=a.cloneNode(!1);if(d.deleteData(0,b),a.deleteData(b,a.length-b),m(d,a),c)for(var f,g=0;f=c[g++];)f.node==a&&f.offset>b?(f.node=d,f.offset-=b):f.node==a.parentNode&&f.offset>e(a)&&++f.offset;return d}function o(a){if(9==a.nodeType)return a;if(typeof a.ownerDocument!=D)return a.ownerDocument;if(typeof a.document!=D)return a.document;if(a.parentNode)return o(a.parentNode);throw b.createError("getDocument: no document found for node")}function p(a){var c=o(a);if(typeof c.defaultView!=D)return c.defaultView;if(typeof c.parentWindow!=D)return c.parentWindow;throw b.createError("Cannot get a window object for node")}function q(a){if(typeof a.contentDocument!=D)return a.contentDocument;if(typeof a.contentWindow!=D)return a.contentWindow.document;throw b.createError("getIframeDocument: No Document object found for iframe element")}function r(a){if(typeof a.contentWindow!=D)return a.contentWindow;if(typeof a.contentDocument!=D)return a.contentDocument.defaultView;throw b.createError("getIframeWindow: No Window object found for iframe element")}function s(a){return a&&E.isHostMethod(a,"setTimeout")&&E.isHostObject(a,"document")}function t(a,b,c){var d;if(a?E.isHostProperty(a,"nodeType")?d=1==a.nodeType&&"iframe"==a.tagName.toLowerCase()?q(a):o(a):s(a)&&(d=a.document):d=document,!d)throw b.createError(c+"(): Parameter must be a Window object or DOM node");return d}function u(a){for(var b;b=a.parentNode;)a=b;return a}function v(a,c,d,f){var h,i,k,l,m;if(a==d)return c===f?0:f>c?-1:1;if(h=j(d,a,!0))return c<=e(h)?-1:1;if(h=j(a,d,!0))return e(h)<f?-1:1;if(i=g(a,d),!i)throw new Error("comparePoints error: nodes have no common ancestor");if(k=a===i?i:j(a,i,!0),l=d===i?i:j(d,i,!0),k===l)throw b.createError("comparePoints got to case 4 and childA and childB are the same!");for(m=i.firstChild;m;){if(m===k)return-1;if(m===l)return 1;m=m.nextSibling}}function w(a){try{return a.parentNode,!1}catch(b){return!0}}function x(a){if(!a)return"[No node]";if(I&&w(a))return"[Broken node]";if(k(a))return'"'+a.data+'"';if(1==a.nodeType){var b=a.id?' id="'+a.id+'"':"";return"<"+a.nodeName+b+">["+e(a)+"]["+a.childNodes.length+"]["+(a.innerHTML||"[innerHTML not supported]").slice(0,25)+"]"}return a.nodeName}function y(a){for(var b,c=o(a).createDocumentFragment();b=a.firstChild;)c.appendChild(b);return c}function z(a){this.root=a,this._next=a}function A(a){return new z(a)}function B(a,b){this.node=a,this.offset=b}function C(a){this.code=this[a],this.codeName=a,this.message="DOMException: "+this.codeName}var D="undefined",E=a.util;E.areHostMethods(document,["createDocumentFragment","createElement","createTextNode"])||b.fail("document missing a Node creation method"),E.isHostMethod(document,"getElementsByTagName")||b.fail("document missing getElementsByTagName method");var F=document.createElement("div");E.areHostMethods(F,["insertBefore","appendChild","cloneNode"]||!E.areHostObjects(F,["previousSibling","nextSibling","childNodes","parentNode"]))||b.fail("Incomplete Element implementation"),E.isHostProperty(F,"innerHTML")||b.fail("Element is missing innerHTML property");var G=document.createTextNode("test");E.areHostMethods(G,["splitText","deleteData","insertData","appendData","cloneNode"]||!E.areHostObjects(F,["previousSibling","nextSibling","childNodes","parentNode"])||!E.areHostProperties(G,["data"]))||b.fail("Incomplete Text Node implementation");var H=function(a,b){for(var c=a.length;c--;)if(a[c]===b)return!0;return!1},I=!1;!function(){var b=document.createElement("b");b.innerHTML="1";var c=b.firstChild;b.innerHTML="<br>",I=w(c),a.features.crashyTextNodes=I}();var J;typeof window.getComputedStyle!=D?J=function(a,b){return p(a).getComputedStyle(a,null)[b]}:typeof document.documentElement.currentStyle!=D?J=function(a,b){return a.currentStyle[b]}:b.fail("No means of obtaining computed style properties found"),z.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){var a,b,c=this._current=this._next;if(this._current)if(a=c.firstChild)this._next=a;else{for(b=null;c!==this.root&&!(b=c.nextSibling);)c=c.parentNode;this._next=b}return this._current},detach:function(){this._current=this._next=this.root=null}},B.prototype={equals:function(a){return!!a&&this.node===a.node&&this.offset==a.offset},inspect:function(){return"[DomPosition("+x(this.node)+":"+this.offset+")]"},toString:function(){return this.inspect()}},C.prototype={INDEX_SIZE_ERR:1,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INVALID_STATE_ERR:11},C.prototype.toString=function(){return this.message},a.dom={arrayContains:H,isHtmlNamespace:c,parentElement:d,getNodeIndex:e,getNodeLength:f,getCommonAncestor:g,isAncestorOf:h,isOrIsAncestorOf:i,getClosestAncestorIn:j,isCharacterDataNode:k,isTextOrCommentNode:l,insertAfter:m,splitDataNode:n,getDocument:o,getWindow:p,getIframeWindow:r,getIframeDocument:q,getBody:E.getBody,isWindow:s,getContentDocument:t,getRootContainer:u,comparePoints:v,isBrokenNode:w,inspectNode:x,getComputedStyleProperty:J,fragmentFromNodeChildren:y,createIterator:A,DomPosition:B},a.DOMException=C})},{"./core":11}],13:[function(a){var b=a("./core");b.api.createCoreModule("DomRange",["DomUtil"],function(a){function b(a,b){return 3!=a.nodeType&&(Q(a,b.startContainer)||Q(a,b.endContainer))}function c(a){return a.document||R(a.startContainer)}function d(a){return new M(a.parentNode,P(a))}function e(a){return new M(a.parentNode,P(a)+1)}function f(a,b,c){var d=11==a.nodeType?a.firstChild:a;return O(b)?c==b.length?K.insertAfter(a,b):b.parentNode.insertBefore(a,0==c?b:T(b,c)):c>=b.childNodes.length?b.appendChild(a):b.insertBefore(a,b.childNodes[c]),d}function g(a,b,d){if(A(a),A(b),c(b)!=c(a))throw new N("WRONG_DOCUMENT_ERR");var e=S(a.startContainer,a.startOffset,b.endContainer,b.endOffset),f=S(a.endContainer,a.endOffset,b.startContainer,b.startOffset);return d?0>=e&&f>=0:0>e&&f>0}function h(a){for(var b,d,e,f=c(a.range).createDocumentFragment();d=a.next();){if(b=a.isPartiallySelectedSubtree(),d=d.cloneNode(!b),b&&(e=a.getSubtreeIterator(),d.appendChild(h(e)),e.detach(!0)),10==d.nodeType)throw new N("HIERARCHY_REQUEST_ERR");f.appendChild(d)}return f}function i(a,b,c){var d,e;c=c||{stop:!1};for(var f,g;f=a.next();)if(a.isPartiallySelectedSubtree()){if(b(f)===!1)return void(c.stop=!0);if(g=a.getSubtreeIterator(),i(g,b,c),g.detach(!0),c.stop)return}else for(d=K.createIterator(f);e=d.next();)if(b(e)===!1)return void(c.stop=!0)}function j(a){for(var b;a.next();)a.isPartiallySelectedSubtree()?(b=a.getSubtreeIterator(),j(b),b.detach(!0)):a.remove()}function k(a){for(var b,d,e=c(a.range).createDocumentFragment();b=a.next();){if(a.isPartiallySelectedSubtree()?(b=b.cloneNode(!1),d=a.getSubtreeIterator(),b.appendChild(k(d)),d.detach(!0)):a.remove(),10==b.nodeType)throw new N("HIERARCHY_REQUEST_ERR");e.appendChild(b)}return e}function l(a,b,c){var d,e=!(!b||!b.length),f=!!c;e&&(d=new RegExp("^("+b.join("|")+")$"));var g=[];return i(new n(a,!1),function(b){if(!(e&&!d.test(b.nodeType)||f&&!c(b))){var h=a.startContainer;if(b!=h||!O(h)||a.startOffset!=h.length){var i=a.endContainer;b==i&&O(i)&&0==a.endOffset||g.push(b)}}}),g}function m(a){var b="undefined"==typeof a.getName?"Range":a.getName();return"["+b+"("+K.inspectNode(a.startContainer)+":"+a.startOffset+", "+K.inspectNode(a.endContainer)+":"+a.endOffset+")]"}function n(a,b){if(this.range=a,this.clonePartiallySelectedTextNodes=b,!a.collapsed){this.sc=a.startContainer,this.so=a.startOffset,this.ec=a.endContainer,this.eo=a.endOffset;var c=a.commonAncestorContainer;this.sc===this.ec&&O(this.sc)?(this.isSingleCharacterDataNode=!0,this._first=this._last=this._next=this.sc):(this._first=this._next=this.sc!==c||O(this.sc)?U(this.sc,c,!0):this.sc.childNodes[this.so],this._last=this.ec!==c||O(this.ec)?U(this.ec,c,!0):this.ec.childNodes[this.eo-1])}}function o(a){this.code=this[a],this.codeName=a,this.message="RangeException: "+this.codeName}function p(a){return function(b,c){for(var d,e=c?b:b.parentNode;e;){if(d=e.nodeType,W(a,d))return e;e=e.parentNode}return null}}function q(a,b){if(eb(a,b))throw new o("INVALID_NODE_TYPE_ERR")}function r(a){if(!a.startContainer)throw new N("INVALID_STATE_ERR")}function s(a,b){if(!W(b,a.nodeType))throw new o("INVALID_NODE_TYPE_ERR")}function t(a,b){if(0>b||b>(O(a)?a.length:a.childNodes.length))throw new N("INDEX_SIZE_ERR")}function u(a,b){if(cb(a,!0)!==cb(b,!0))throw new N("WRONG_DOCUMENT_ERR")}function v(a){if(db(a,!0))throw new N("NO_MODIFICATION_ALLOWED_ERR")}function w(a,b){if(!a)throw new N(b)}function x(a){return Y&&K.isBrokenNode(a)||!W($,a.nodeType)&&!cb(a,!0)}function y(a,b){return b<=(O(a)?a.length:a.childNodes.length)}function z(a){return!!a.startContainer&&!!a.endContainer&&!x(a.startContainer)&&!x(a.endContainer)&&y(a.startContainer,a.startOffset)&&y(a.endContainer,a.endOffset)}function A(a){if(r(a),!z(a))throw new Error("Range error: Range is no longer valid after DOM mutation ("+a.inspect()+")")}function B(a,b){A(a);var c=a.startContainer,d=a.startOffset,e=a.endContainer,f=a.endOffset,g=c===e;O(e)&&f>0&&f<e.length&&T(e,f,b),O(c)&&d>0&&d<c.length&&(c=T(c,d,b),g?(f-=d,e=c):e==c.parentNode&&f>=P(c)&&f++,d=0),a.setStartAndEnd(c,d,e,f)}function C(a){a.START_TO_START=kb,a.START_TO_END=lb,a.END_TO_END=mb,a.END_TO_START=nb,a.NODE_BEFORE=ob,a.NODE_AFTER=pb,a.NODE_BEFORE_AND_AFTER=qb,a.NODE_INSIDE=rb}function D(a){C(a),C(a.prototype)}function E(a,b){return function(){A(this);var c,d,f=this.startContainer,g=this.startOffset,h=this.commonAncestorContainer,j=new n(this,!0);f!==h&&(c=U(f,h,!0),d=e(c),f=d.node,g=d.offset),i(j,v),j.reset();var k=a(j);return j.detach(),b(this,f,g,f,g),k}}function F(c,f,g){function h(a,b){return function(c){r(this),s(c,Z),s(X(c),$);var f=(a?d:e)(c);(b?i:l)(this,f.node,f.offset)}}function i(a,b,c){var d=a.endContainer,e=a.endOffset;(b!==a.startContainer||c!==a.startOffset)&&((X(b)!=X(d)||1==S(b,c,d,e))&&(d=b,e=c),f(a,b,c,d,e))}function l(a,b,c){var d=a.startContainer,e=a.startOffset;(b!==a.endContainer||c!==a.endOffset)&&((X(b)!=X(d)||-1==S(b,c,d,e))&&(d=b,e=c),f(a,d,e,b,c))}var m=function(){};m.prototype=a.rangePrototype,c.prototype=new m,L.extend(c.prototype,{setStart:function(a,b){r(this),q(a,!0),t(a,b),i(this,a,b)},setEnd:function(a,b){r(this),q(a,!0),t(a,b),l(this,a,b)},setStartAndEnd:function(){r(this);var a=arguments,b=a[0],c=a[1],d=b,e=c;switch(a.length){case 3:e=a[2];break;case 4:d=a[2],e=a[3]}f(this,b,c,d,e)},setBoundary:function(a,b,c){this["set"+(c?"Start":"End")](a,b)},setStartBefore:h(!0,!0),setStartAfter:h(!1,!0),setEndBefore:h(!0,!1),setEndAfter:h(!1,!1),collapse:function(a){A(this),a?f(this,this.startContainer,this.startOffset,this.startContainer,this.startOffset):f(this,this.endContainer,this.endOffset,this.endContainer,this.endOffset)},selectNodeContents:function(a){r(this),q(a,!0),f(this,a,0,a,V(a))},selectNode:function(a){r(this),q(a,!1),s(a,Z);var b=d(a),c=e(a);f(this,b.node,b.offset,c.node,c.offset)},extractContents:E(k,f),deleteContents:E(j,f),canSurroundContents:function(){A(this),v(this.startContainer),v(this.endContainer);var a=new n(this,!0),c=a._first&&b(a._first,this)||a._last&&b(a._last,this);return a.detach(),!c},detach:function(){g(this)},splitBoundaries:function(){B(this)},splitBoundariesPreservingPositions:function(a){B(this,a)},normalizeBoundaries:function(){A(this);var a=this.startContainer,b=this.startOffset,c=this.endContainer,d=this.endOffset,e=function(a){var b=a.nextSibling;b&&b.nodeType==a.nodeType&&(c=a,d=a.length,a.appendData(b.data),b.parentNode.removeChild(b))},g=function(e){var f=e.previousSibling;if(f&&f.nodeType==e.nodeType){a=e;var g=e.length;if(b=f.length,e.insertData(0,f.data),f.parentNode.removeChild(f),a==c)d+=b,c=a;else if(c==e.parentNode){var h=P(e);d==h?(c=e,d=g):d>h&&d--}}},h=!0;if(O(c))c.length==d&&e(c);else{if(d>0){var i=c.childNodes[d-1];i&&O(i)&&e(i)}h=!this.collapsed}if(h){if(O(a))0==b&&g(a);else if(b<a.childNodes.length){var j=a.childNodes[b];j&&O(j)&&g(j)}}else a=c,b=d;f(this,a,b,c,d)},collapseToPoint:function(a,b){r(this),q(a,!0),t(a,b),this.setStartAndEnd(a,b)}}),D(c)}function G(a){a.collapsed=a.startContainer===a.endContainer&&a.startOffset===a.endOffset,a.commonAncestorContainer=a.collapsed?a.startContainer:K.getCommonAncestor(a.startContainer,a.endContainer)}function H(a,b,c,d,e){a.startContainer=b,a.startOffset=c,a.endContainer=d,a.endOffset=e,a.document=K.getDocument(b),G(a)}function I(a){r(a),a.startContainer=a.startOffset=a.endContainer=a.endOffset=a.document=null,a.collapsed=a.commonAncestorContainer=null}function J(a){this.startContainer=a,this.startOffset=0,this.endContainer=a,this.endOffset=0,this.document=a,G(this)}var K=a.dom,L=a.util,M=K.DomPosition,N=a.DOMException,O=K.isCharacterDataNode,P=K.getNodeIndex,Q=K.isOrIsAncestorOf,R=K.getDocument,S=K.comparePoints,T=K.splitDataNode,U=K.getClosestAncestorIn,V=K.getNodeLength,W=K.arrayContains,X=K.getRootContainer,Y=a.features.crashyTextNodes;n.prototype={_current:null,_next:null,_first:null,_last:null,isSingleCharacterDataNode:!1,reset:function(){this._current=null,this._next=this._first},hasNext:function(){return!!this._next},next:function(){var a=this._current=this._next;return a&&(this._next=a!==this._last?a.nextSibling:null,O(a)&&this.clonePartiallySelectedTextNodes&&(a===this.ec&&(a=a.cloneNode(!0)).deleteData(this.eo,a.length-this.eo),this._current===this.sc&&(a=a.cloneNode(!0)).deleteData(0,this.so))),a},remove:function(){var a,b,c=this._current;!O(c)||c!==this.sc&&c!==this.ec?c.parentNode&&c.parentNode.removeChild(c):(a=c===this.sc?this.so:0,b=c===this.ec?this.eo:c.length,a!=b&&c.deleteData(a,b-a))},isPartiallySelectedSubtree:function(){var a=this._current;return b(a,this.range)},getSubtreeIterator:function(){var a;if(this.isSingleCharacterDataNode)a=this.range.cloneRange(),a.collapse(!1);else{a=new J(c(this.range));var b=this._current,d=b,e=0,f=b,g=V(b);Q(b,this.sc)&&(d=this.sc,e=this.so),Q(b,this.ec)&&(f=this.ec,g=this.eo),H(a,d,e,f,g)}return new n(a,this.clonePartiallySelectedTextNodes)},detach:function(a){a&&this.range.detach(),this.range=this._current=this._next=this._first=this._last=this.sc=this.so=this.ec=this.eo=null}},o.prototype={BAD_BOUNDARYPOINTS_ERR:1,INVALID_NODE_TYPE_ERR:2},o.prototype.toString=function(){return this.message};var Z=[1,3,4,5,7,8,10],$=[2,9,11],_=[5,6,10,12],ab=[1,3,4,5,7,8,10,11],bb=[1,3,4,5,7,8],cb=p([9,11]),db=p(_),eb=p([6,10,12]),fb=document.createElement("style"),gb=!1;try{fb.innerHTML="<b>x</b>",gb=3==fb.firstChild.nodeType}catch(hb){}a.features.htmlParsingConforms=gb;var ib=gb?function(a){var b=this.startContainer,c=R(b);if(!b)throw new N("INVALID_STATE_ERR");var d=null;return 1==b.nodeType?d=b:O(b)&&(d=K.parentElement(b)),d=null===d||"HTML"==d.nodeName&&K.isHtmlNamespace(R(d).documentElement)&&K.isHtmlNamespace(d)?c.createElement("body"):d.cloneNode(!1),d.innerHTML=a,K.fragmentFromNodeChildren(d)}:function(a){r(this);var b=c(this),d=b.createElement("body");return d.innerHTML=a,K.fragmentFromNodeChildren(d)},jb=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],kb=0,lb=1,mb=2,nb=3,ob=0,pb=1,qb=2,rb=3;L.extend(a.rangePrototype,{compareBoundaryPoints:function(a,b){A(this),u(this.startContainer,b.startContainer);var c,d,e,f,g=a==nb||a==kb?"start":"end",h=a==lb||a==kb?"start":"end";return c=this[g+"Container"],d=this[g+"Offset"],e=b[h+"Container"],f=b[h+"Offset"],S(c,d,e,f)},insertNode:function(a){if(A(this),s(a,ab),v(this.startContainer),Q(a,this.startContainer))throw new N("HIERARCHY_REQUEST_ERR");var b=f(a,this.startContainer,this.startOffset);this.setStartBefore(b)},cloneContents:function(){A(this);var a,b;if(this.collapsed)return c(this).createDocumentFragment();if(this.startContainer===this.endContainer&&O(this.startContainer))return a=this.startContainer.cloneNode(!0),a.data=a.data.slice(this.startOffset,this.endOffset),b=c(this).createDocumentFragment(),b.appendChild(a),b;var d=new n(this,!0);return a=h(d),d.detach(),a},canSurroundContents:function(){A(this),v(this.startContainer),v(this.endContainer);var a=new n(this,!0),c=a._first&&b(a._first,this)||a._last&&b(a._last,this);return a.detach(),!c},surroundContents:function(a){if(s(a,bb),!this.canSurroundContents())throw new o("BAD_BOUNDARYPOINTS_ERR");var b=this.extractContents();if(a.hasChildNodes())for(;a.lastChild;)a.removeChild(a.lastChild);f(a,this.startContainer,this.startOffset),a.appendChild(b),this.selectNode(a)},cloneRange:function(){A(this);for(var a,b=new J(c(this)),d=jb.length;d--;)a=jb[d],b[a]=this[a];return b},toString:function(){A(this);var a=this.startContainer;if(a===this.endContainer&&O(a))return 3==a.nodeType||4==a.nodeType?a.data.slice(this.startOffset,this.endOffset):"";var b=[],c=new n(this,!0);return i(c,function(a){(3==a.nodeType||4==a.nodeType)&&b.push(a.data)}),c.detach(),b.join("")},compareNode:function(a){A(this);var b=a.parentNode,c=P(a);if(!b)throw new N("NOT_FOUND_ERR");var d=this.comparePoint(b,c),e=this.comparePoint(b,c+1);return 0>d?e>0?qb:ob:e>0?pb:rb},comparePoint:function(a,b){return A(this),w(a,"HIERARCHY_REQUEST_ERR"),u(a,this.startContainer),S(a,b,this.startContainer,this.startOffset)<0?-1:S(a,b,this.endContainer,this.endOffset)>0?1:0},createContextualFragment:ib,toHtml:function(){A(this);var a=this.commonAncestorContainer.parentNode.cloneNode(!1);return a.appendChild(this.cloneContents()),a.innerHTML},intersectsNode:function(a,b){if(A(this),w(a,"NOT_FOUND_ERR"),R(a)!==c(this))return!1;var d=a.parentNode,e=P(a);w(d,"NOT_FOUND_ERR");var f=S(d,e,this.endContainer,this.endOffset),g=S(d,e+1,this.startContainer,this.startOffset);return b?0>=f&&g>=0:0>f&&g>0},isPointInRange:function(a,b){return A(this),w(a,"HIERARCHY_REQUEST_ERR"),u(a,this.startContainer),S(a,b,this.startContainer,this.startOffset)>=0&&S(a,b,this.endContainer,this.endOffset)<=0},intersectsRange:function(a){return g(this,a,!1)},intersectsOrTouchesRange:function(a){return g(this,a,!0)},intersection:function(a){if(this.intersectsRange(a)){var b=S(this.startContainer,this.startOffset,a.startContainer,a.startOffset),c=S(this.endContainer,this.endOffset,a.endContainer,a.endOffset),d=this.cloneRange();return-1==b&&d.setStart(a.startContainer,a.startOffset),1==c&&d.setEnd(a.endContainer,a.endOffset),d}return null},union:function(a){if(this.intersectsOrTouchesRange(a)){var b=this.cloneRange();return-1==S(a.startContainer,a.startOffset,this.startContainer,this.startOffset)&&b.setStart(a.startContainer,a.startOffset),1==S(a.endContainer,a.endOffset,this.endContainer,this.endOffset)&&b.setEnd(a.endContainer,a.endOffset),b}throw new o("Ranges do not intersect")},containsNode:function(a,b){return b?this.intersectsNode(a,!1):this.compareNode(a)==rb},containsNodeContents:function(a){return this.comparePoint(a,0)>=0&&this.comparePoint(a,V(a))<=0},containsRange:function(a){var b=this.intersection(a);return null!==b&&a.equals(b)},containsNodeText:function(a){var b=this.cloneRange();b.selectNode(a);var c=b.getNodes([3]);if(c.length>0){b.setStart(c[0],0);var d=c.pop();b.setEnd(d,d.length);var e=this.containsRange(b);return b.detach(),e}return this.containsNodeContents(a)},getNodes:function(a,b){return A(this),l(this,a,b)},getDocument:function(){return c(this)},collapseBefore:function(a){r(this),this.setEndBefore(a),this.collapse(!1)},collapseAfter:function(a){r(this),this.setStartAfter(a),this.collapse(!0)},getBookmark:function(b){var d=c(this),e=a.createRange(d);b=b||K.getBody(d),e.selectNodeContents(b);var f=this.intersection(e),g=0,h=0;return f&&(e.setEnd(f.startContainer,f.startOffset),g=e.toString().length,h=g+f.toString().length,e.detach()),{start:g,end:h,containerNode:b}},moveToBookmark:function(a){var b=a.containerNode,c=0;this.setStart(b,0),this.collapse(!0);for(var d,e,f,g,h=[b],i=!1,j=!1;!j&&(d=h.pop());)if(3==d.nodeType)e=c+d.length,!i&&a.start>=c&&a.start<=e&&(this.setStart(d,a.start-c),i=!0),i&&a.end>=c&&a.end<=e&&(this.setEnd(d,a.end-c),j=!0),c=e;else for(g=d.childNodes,f=g.length;f--;)h.push(g[f])},getName:function(){return"DomRange"},equals:function(a){return J.rangesEqual(this,a)},isValid:function(){return z(this)},inspect:function(){return m(this)}}),F(J,H,I),L.extend(J,{rangeProperties:jb,RangeIterator:n,copyComparisonConstants:D,createPrototypeRange:F,inspect:m,getRangeDocument:c,rangesEqual:function(a,b){return a.startContainer===b.startContainer&&a.startOffset===b.startOffset&&a.endContainer===b.endContainer&&a.endOffset===b.endOffset}}),a.DomRange=J,a.RangeException=o})},{"./core":11}],14:[function(a){var b=a("./core");b.api.createModule("SaveRestore",["WrappedRange"],function(a,b){function c(a,b){return(b||document).getElementById(a)}function d(a,b){var c,d="selectionBoundary_"+ +new Date+"_"+(""+Math.random()).slice(2),e=o.getDocument(a.startContainer),f=a.cloneRange();return f.collapse(b),c=e.createElement("span"),c.id=d,c.style.lineHeight="0",c.style.display="none",c.className="rangySelectionBoundary",c.appendChild(e.createTextNode(p)),f.insertNode(c),f.detach(),c}function e(a,d,e,f){var g=c(e,a);g?(d[f?"setStartBefore":"setEndBefore"](g),g.parentNode.removeChild(g)):b.warn("Marker element has been removed. Cannot restore selection.")}function f(a,b){return b.compareBoundaryPoints(a.START_TO_START,a)}function g(b,c){var e,f,g=a.DomRange.getRangeDocument(b),h=b.toString();return b.collapsed?(f=d(b,!1),{document:g,markerId:f.id,collapsed:!0}):(f=d(b,!1),e=d(b,!0),{document:g,startMarkerId:e.id,endMarkerId:f.id,collapsed:!1,backward:c,toString:function(){return"original text: '"+h+"', new text: '"+b.toString()+"'"}})}function h(d,f){var g=d.document;"undefined"==typeof f&&(f=!0);var h=a.createRange(g);if(d.collapsed){var i=c(d.markerId,g);if(i){i.style.display="inline";var j=i.previousSibling;j&&3==j.nodeType?(i.parentNode.removeChild(i),h.collapseToPoint(j,j.length)):(h.collapseBefore(i),i.parentNode.removeChild(i))}else b.warn("Marker element has been removed. Cannot restore selection.")}else e(g,h,d.startMarkerId,!0),e(g,h,d.endMarkerId,!1);
return f&&h.normalizeBoundaries(),h}function i(b,d){var e,h,i=[];b=b.slice(0),b.sort(f);for(var j=0,k=b.length;k>j;++j)i[j]=g(b[j],d);for(j=k-1;j>=0;--j)e=b[j],h=a.DomRange.getRangeDocument(e),e.collapsed?e.collapseAfter(c(i[j].markerId,h)):(e.setEndBefore(c(i[j].endMarkerId,h)),e.setStartAfter(c(i[j].startMarkerId,h)));return i}function j(c){if(!a.isSelectionValid(c))return b.warn("Cannot save selection. This usually happens when the selection is collapsed and the selection document has lost focus."),null;var d=a.getSelection(c),e=d.getAllRanges(),f=1==e.length&&d.isBackward(),g=i(e,f);return f?d.setSingleRange(e[0],"backward"):d.setRanges(e),{win:c,rangeInfos:g,restored:!1}}function k(a){for(var b=[],c=a.length,d=c-1;d>=0;d--)b[d]=h(a[d],!0);return b}function l(b,c){if(!b.restored){var d=b.rangeInfos,e=a.getSelection(b.win),f=k(d),g=d.length;1==g&&c&&a.features.selectionHasExtend&&d[0].backward?(e.removeAllRanges(),e.addRange(f[0],!0)):e.setRanges(f),b.restored=!0}}function m(a,b){var d=c(b,a);d&&d.parentNode.removeChild(d)}function n(a){for(var b,c=a.rangeInfos,d=0,e=c.length;e>d;++d)b=c[d],b.collapsed?m(a.doc,b.markerId):(m(a.doc,b.startMarkerId),m(a.doc,b.endMarkerId))}var o=a.dom,p="";a.util.extend(a,{saveRange:g,restoreRange:h,saveRanges:i,restoreRanges:k,saveSelection:j,restoreSelection:l,removeMarkerElement:m,removeMarkers:n})})},{"./core":11}],15:[function(a){var b=a("./core");b.api.createCoreModule("WrappedRange",["DomRange"],function(a,b){var c,d,e=a.dom,f=a.util,g=e.DomPosition,h=a.DomRange,i=e.getBody,j=e.getContentDocument,k=e.isCharacterDataNode;if(a.features.implementsDomRange&&!function(){function d(a){for(var b,c=n.length;c--;)b=n[c],a[b]=a.nativeRange[b];a.collapsed=a.startContainer===a.endContainer&&a.startOffset===a.endOffset}function g(a,b,c,d,e){var f=a.startContainer!==b||a.startOffset!=c,g=a.endContainer!==d||a.endOffset!=e,h=!a.equals(a.nativeRange);(f||g||h)&&(a.setEnd(d,e),a.setStart(b,c))}function k(a){a.nativeRange.detach(),a.detached=!0;for(var b=n.length;b--;)a[n[b]]=null}var l,m,n=h.rangeProperties;c=function(a){if(!a)throw b.createError("WrappedRange: Range must be specified");this.nativeRange=a,d(this)},h.createPrototypeRange(c,g,k),l=c.prototype,l.selectNode=function(a){this.nativeRange.selectNode(a),d(this)},l.cloneContents=function(){return this.nativeRange.cloneContents()},l.surroundContents=function(a){this.nativeRange.surroundContents(a),d(this)},l.collapse=function(a){this.nativeRange.collapse(a),d(this)},l.cloneRange=function(){return new c(this.nativeRange.cloneRange())},l.refresh=function(){d(this)},l.toString=function(){return this.nativeRange.toString()};var o=document.createTextNode("test");i(document).appendChild(o);var p=document.createRange();p.setStart(o,0),p.setEnd(o,0);try{p.setStart(o,1),l.setStart=function(a,b){this.nativeRange.setStart(a,b),d(this)},l.setEnd=function(a,b){this.nativeRange.setEnd(a,b),d(this)},m=function(a){return function(b){this.nativeRange[a](b),d(this)}}}catch(q){l.setStart=function(a,b){try{this.nativeRange.setStart(a,b)}catch(c){this.nativeRange.setEnd(a,b),this.nativeRange.setStart(a,b)}d(this)},l.setEnd=function(a,b){try{this.nativeRange.setEnd(a,b)}catch(c){this.nativeRange.setStart(a,b),this.nativeRange.setEnd(a,b)}d(this)},m=function(a,b){return function(c){try{this.nativeRange[a](c)}catch(e){this.nativeRange[b](c),this.nativeRange[a](c)}d(this)}}}l.setStartBefore=m("setStartBefore","setEndBefore"),l.setStartAfter=m("setStartAfter","setEndAfter"),l.setEndBefore=m("setEndBefore","setStartBefore"),l.setEndAfter=m("setEndAfter","setStartAfter"),l.selectNodeContents=function(a){this.setStartAndEnd(a,0,e.getNodeLength(a))},p.selectNodeContents(o),p.setEnd(o,3);var r=document.createRange();r.selectNodeContents(o),r.setEnd(o,4),r.setStart(o,2),l.compareBoundaryPoints=-1==p.compareBoundaryPoints(p.START_TO_END,r)&&1==p.compareBoundaryPoints(p.END_TO_START,r)?function(a,b){return b=b.nativeRange||b,a==b.START_TO_END?a=b.END_TO_START:a==b.END_TO_START&&(a=b.START_TO_END),this.nativeRange.compareBoundaryPoints(a,b)}:function(a,b){return this.nativeRange.compareBoundaryPoints(a,b.nativeRange||b)};var s=document.createElement("div");s.innerHTML="123";var t=s.firstChild,u=i(document);u.appendChild(s),p.setStart(t,1),p.setEnd(t,2),p.deleteContents(),"13"==t.data&&(l.deleteContents=function(){this.nativeRange.deleteContents(),d(this)},l.extractContents=function(){var a=this.nativeRange.extractContents();return d(this),a}),u.removeChild(s),u=null,f.isHostMethod(p,"createContextualFragment")&&(l.createContextualFragment=function(a){return this.nativeRange.createContextualFragment(a)}),i(document).removeChild(o),p.detach(),r.detach(),l.getName=function(){return"WrappedRange"},a.WrappedRange=c,a.createNativeRange=function(a){return a=j(a,b,"createNativeRange"),a.createRange()}}(),a.features.implementsTextRange){var l=function(a){var b=a.parentElement(),c=a.duplicate();c.collapse(!0);var d=c.parentElement();c=a.duplicate(),c.collapse(!1);var f=c.parentElement(),g=d==f?d:e.getCommonAncestor(d,f);return g==b?g:e.getCommonAncestor(b,g)},m=function(a){return 0==a.compareEndPoints("StartToEnd",a)},n=function(a,b,c,d,f){var h=a.duplicate();h.collapse(c);var i=h.parentElement();if(e.isOrIsAncestorOf(b,i)||(i=b),!i.canHaveHTML){var j=new g(i.parentNode,e.getNodeIndex(i));return{boundaryPosition:j,nodeInfo:{nodeIndex:j.offset,containerElement:j.node}}}var l=e.getDocument(i).createElement("span");l.parentNode&&l.parentNode.removeChild(l);for(var m,n,o,p,q,r=c?"StartToStart":"StartToEnd",s=f&&f.containerElement==i?f.nodeIndex:0,t=i.childNodes.length,u=t,v=u;;){if(v==t?i.appendChild(l):i.insertBefore(l,i.childNodes[v]),h.moveToElementText(l),m=h.compareEndPoints(r,a),0==m||s==u)break;if(-1==m){if(u==s+1)break;s=v}else u=u==s+1?s:v;v=Math.floor((s+u)/2),i.removeChild(l)}if(q=l.nextSibling,-1==m&&q&&k(q)){h.setEndPoint(c?"EndToStart":"EndToEnd",a);var w;if(/[\r\n]/.test(q.data)){var x=h.duplicate(),y=x.text.replace(/\r\n/g,"\r").length;for(w=x.moveStart("character",y);-1==(m=x.compareEndPoints("StartToEnd",x));)w++,x.moveStart("character",1)}else w=h.text.length;p=new g(q,w)}else n=(d||!c)&&l.previousSibling,o=(d||c)&&l.nextSibling,p=o&&k(o)?new g(o,0):n&&k(n)?new g(n,n.data.length):new g(i,e.getNodeIndex(l));return l.parentNode.removeChild(l),{boundaryPosition:p,nodeInfo:{nodeIndex:v,containerElement:i}}},o=function(a,b){var c,d,f,g,h=a.offset,j=e.getDocument(a.node),l=i(j).createTextRange(),m=k(a.node);return m?(c=a.node,d=c.parentNode):(g=a.node.childNodes,c=h<g.length?g[h]:null,d=a.node),f=j.createElement("span"),f.innerHTML="&#feff;",c?d.insertBefore(f,c):d.appendChild(f),l.moveToElementText(f),l.collapse(!b),d.removeChild(f),m&&l[b?"moveStart":"moveEnd"]("character",h),l};if(d=function(a){this.textRange=a,this.refresh()},d.prototype=new h(document),d.prototype.refresh=function(){var a,b,c,d=l(this.textRange);m(this.textRange)?b=a=n(this.textRange,d,!0,!0).boundaryPosition:(c=n(this.textRange,d,!0,!1),a=c.boundaryPosition,b=n(this.textRange,d,!1,!1,c.nodeInfo).boundaryPosition),this.setStart(a.node,a.offset),this.setEnd(b.node,b.offset)},d.prototype.getName=function(){return"WrappedTextRange"},h.copyComparisonConstants(d),d.rangeToTextRange=function(a){if(a.collapsed)return o(new g(a.startContainer,a.startOffset),!0);var b=o(new g(a.startContainer,a.startOffset),!0),c=o(new g(a.endContainer,a.endOffset),!1),d=i(h.getRangeDocument(a)).createTextRange();return d.setEndPoint("StartToStart",b),d.setEndPoint("EndToEnd",c),d},a.WrappedTextRange=d,!a.features.implementsDomRange||a.config.preferTextRange){var p=function(){return this}();"undefined"==typeof p.Range&&(p.Range=d),a.createNativeRange=function(a){return a=j(a,b,"createNativeRange"),i(a).createTextRange()},a.WrappedRange=d}}a.createRange=function(c){return c=j(c,b,"createRange"),new a.WrappedRange(a.createNativeRange(c))},a.createRangyRange=function(a){return a=j(a,b,"createRangyRange"),new h(a)},a.createIframeRange=function(c){return b.deprecationNotice("createIframeRange()","createRange(iframeEl)"),a.createRange(c)},a.createIframeRangyRange=function(c){return b.deprecationNotice("createIframeRangyRange()","createRangyRange(iframeEl)"),a.createRangyRange(c)},a.addCreateMissingNativeApiListener(function(b){var c=b.document;"undefined"==typeof c.createRange&&(c.createRange=function(){return a.createRange(c)}),c=b=null})})},{"./core":11}],16:[function(a){var b=a("./core");b.api.createCoreModule("WrappedSelection",["DomRange","WrappedRange"],function(a,b){function c(a){return"string"==typeof a?/^backward(s)?$/i.test(a):!!a}function d(a,c){if(a){if(C.isWindow(a))return a;if(a instanceof r)return a.win;var d=C.getContentDocument(a,b,c);return C.getWindow(d)}return window}function e(a){return d(a,"getWinSelection").getSelection()}function f(a){return d(a,"getDocSelection").document.selection}function g(a){var b=!1;return a.anchorNode&&(b=1==C.comparePoints(a.anchorNode,a.anchorOffset,a.focusNode,a.focusOffset)),b}function h(a,b,c){var d=c?"end":"start",e=c?"start":"end";a.anchorNode=b[d+"Container"],a.anchorOffset=b[d+"Offset"],a.focusNode=b[e+"Container"],a.focusOffset=b[e+"Offset"]}function i(a){var b=a.nativeSelection;a.anchorNode=b.anchorNode,a.anchorOffset=b.anchorOffset,a.focusNode=b.focusNode,a.focusOffset=b.focusOffset}function j(a){a.anchorNode=a.focusNode=null,a.anchorOffset=a.focusOffset=0,a.rangeCount=0,a.isCollapsed=!0,a._ranges.length=0}function k(b){var c;return b instanceof F?(c=a.createNativeRange(b.getDocument()),c.setEnd(b.endContainer,b.endOffset),c.setStart(b.startContainer,b.startOffset)):b instanceof G?c=b.nativeRange:J.implementsDomRange&&b instanceof C.getWindow(b.startContainer).Range&&(c=b),c}function l(a){if(!a.length||1!=a[0].nodeType)return!1;for(var b=1,c=a.length;c>b;++b)if(!C.isAncestorOf(a[0],a[b]))return!1;return!0}function m(a){var c=a.getNodes();if(!l(c))throw b.createError("getSingleElementFromRange: range "+a.inspect()+" did not consist of a single element");return c[0]}function n(a){return!!a&&"undefined"!=typeof a.text}function o(a,b){var c=new G(b);a._ranges=[c],h(a,c,!1),a.rangeCount=1,a.isCollapsed=c.collapsed}function p(b){if(b._ranges.length=0,"None"==b.docSelection.type)j(b);else{var c=b.docSelection.createRange();if(n(c))o(b,c);else{b.rangeCount=c.length;for(var d,e=L(c.item(0)),f=0;f<b.rangeCount;++f)d=a.createRange(e),d.selectNode(c.item(f)),b._ranges.push(d);b.isCollapsed=1==b.rangeCount&&b._ranges[0].collapsed,h(b,b._ranges[b.rangeCount-1],!1)}}}function q(a,c){for(var d=a.docSelection.createRange(),e=m(c),f=L(d.item(0)),g=M(f).createControlRange(),h=0,i=d.length;i>h;++h)g.add(d.item(h));try{g.add(e)}catch(j){throw b.createError("addRange(): Element within the specified Range could not be added to control selection (does it have layout?)")}g.select(),p(a)}function r(a,b,c){this.nativeSelection=a,this.docSelection=b,this._ranges=[],this.win=c,this.refresh()}function s(a){a.win=a.anchorNode=a.focusNode=a._ranges=null,a.rangeCount=a.anchorOffset=a.focusOffset=0,a.detached=!0}function t(a,b){for(var c,d,e=bb.length;e--;)if(c=bb[e],d=c.selection,"deleteAll"==b)s(d);else if(c.win==a)return"delete"==b?(bb.splice(e,1),!0):d;return"deleteAll"==b&&(bb.length=0),null}function u(a,c){for(var d,e=L(c[0].startContainer),f=M(e).createControlRange(),g=0,h=c.length;h>g;++g){d=m(c[g]);try{f.add(d)}catch(i){throw b.createError("setRanges(): Element within one of the specified Ranges could not be added to control selection (does it have layout?)")}}f.select(),p(a)}function v(a,b){if(a.win.document!=L(b))throw new H("WRONG_DOCUMENT_ERR")}function w(b){return function(c,d){var e;this.rangeCount?(e=this.getRangeAt(0),e["set"+(b?"Start":"End")](c,d)):(e=a.createRange(this.win.document),e.setStartAndEnd(c,d)),this.setSingleRange(e,this.isBackward())}}function x(a){var b=[],c=new I(a.anchorNode,a.anchorOffset),d=new I(a.focusNode,a.focusOffset),e="function"==typeof a.getName?a.getName():"Selection";if("undefined"!=typeof a.rangeCount)for(var f=0,g=a.rangeCount;g>f;++f)b[f]=F.inspect(a.getRangeAt(f));return"["+e+"(Ranges: "+b.join(", ")+")(anchor: "+c.inspect()+", focus: "+d.inspect()+"]"}a.config.checkSelectionRanges=!0;var y,z,A="boolean",B="number",C=a.dom,D=a.util,E=D.isHostMethod,F=a.DomRange,G=a.WrappedRange,H=a.DOMException,I=C.DomPosition,J=a.features,K="Control",L=C.getDocument,M=C.getBody,N=F.rangesEqual,O=E(window,"getSelection"),P=D.isHostObject(document,"selection");J.implementsWinGetSelection=O,J.implementsDocSelection=P;var Q=P&&(!O||a.config.preferTextRange);Q?(y=f,a.isSelectionValid=function(a){var b=d(a,"isSelectionValid").document,c=b.selection;return"None"!=c.type||L(c.createRange().parentElement())==b}):O?(y=e,a.isSelectionValid=function(){return!0}):b.fail("Neither document.selection or window.getSelection() detected."),a.getNativeSelection=y;var R=y(),S=a.createNativeRange(document),T=M(document),U=D.areHostProperties(R,["anchorNode","focusNode","anchorOffset","focusOffset"]);J.selectionHasAnchorAndFocus=U;var V=E(R,"extend");J.selectionHasExtend=V;var W=typeof R.rangeCount==B;J.selectionHasRangeCount=W;var X=!1,Y=!0,Z=V?function(b,c){var d=F.getRangeDocument(c),e=a.createRange(d);e.collapseToPoint(c.endContainer,c.endOffset),b.addRange(k(e)),b.extend(c.startContainer,c.startOffset)}:null;D.areHostMethods(R,["addRange","getRangeAt","removeAllRanges"])&&typeof R.rangeCount==B&&J.implementsDomRange&&!function(){var b=window.getSelection();if(b){for(var c=b.rangeCount,d=c>1,e=[],f=g(b),h=0;c>h;++h)e[h]=b.getRangeAt(h);var i=M(document),j=i.appendChild(document.createElement("div"));j.contentEditable="false";var k=j.appendChild(document.createTextNode("   ")),l=document.createRange();if(l.setStart(k,1),l.collapse(!0),b.addRange(l),Y=1==b.rangeCount,b.removeAllRanges(),!d){var m=l.cloneRange();l.setStart(k,0),m.setEnd(k,3),m.setStart(k,2),b.addRange(l),b.addRange(m),X=2==b.rangeCount,m.detach()}for(i.removeChild(j),b.removeAllRanges(),l.detach(),h=0;c>h;++h)0==h&&f?Z?Z(b,e[h]):(a.warn("Rangy initialization: original selection was backwards but selection has been restored forwards because browser does not support Selection.extend"),b.addRange(e[h])):b.addRange(e[h])}}(),J.selectionSupportsMultipleRanges=X,J.collapsedNonEditableSelectionsSupported=Y;var $,_=!1;T&&E(T,"createControlRange")&&($=T.createControlRange(),D.areHostProperties($,["item","add"])&&(_=!0)),J.implementsControlRange=_,z=U?function(a){return a.anchorNode===a.focusNode&&a.anchorOffset===a.focusOffset}:function(a){return a.rangeCount?a.getRangeAt(a.rangeCount-1).collapsed:!1};var ab;E(R,"getRangeAt")?ab=function(a,b){try{return a.getRangeAt(b)}catch(c){return null}}:U&&(ab=function(b){var c=L(b.anchorNode),d=a.createRange(c);return d.setStartAndEnd(b.anchorNode,b.anchorOffset,b.focusNode,b.focusOffset),d.collapsed!==this.isCollapsed&&d.setStartAndEnd(b.focusNode,b.focusOffset,b.anchorNode,b.anchorOffset),d}),r.prototype=a.selectionPrototype;var bb=[],cb=function(a){if(a&&a instanceof r)return a.refresh(),a;a=d(a,"getNativeSelection");var b=t(a),c=y(a),e=P?f(a):null;return b?(b.nativeSelection=c,b.docSelection=e,b.refresh()):(b=new r(c,e,a),bb.push({win:a,selection:b})),b};a.getSelection=cb,a.getIframeSelection=function(c){return b.deprecationNotice("getIframeSelection()","getSelection(iframeEl)"),a.getSelection(C.getIframeWindow(c))};var db=r.prototype;if(!Q&&U&&D.areHostMethods(R,["removeAllRanges","addRange"])){db.removeAllRanges=function(){this.nativeSelection.removeAllRanges(),j(this)};var eb=function(a,b){Z(a.nativeSelection,b),a.refresh()};db.addRange=W?function(b,d){if(_&&P&&this.docSelection.type==K)q(this,b);else if(c(d)&&V)eb(this,b);else{var e;if(X?e=this.rangeCount:(this.removeAllRanges(),e=0),this.nativeSelection.addRange(k(b).cloneRange()),this.rangeCount=this.nativeSelection.rangeCount,this.rangeCount==e+1){if(a.config.checkSelectionRanges){var f=ab(this.nativeSelection,this.rangeCount-1);f&&!N(f,b)&&(b=new G(f))}this._ranges[this.rangeCount-1]=b,h(this,b,hb(this.nativeSelection)),this.isCollapsed=z(this)}else this.refresh()}}:function(a,b){c(b)&&V?eb(this,a):(this.nativeSelection.addRange(k(a)),this.refresh())},db.setRanges=function(a){if(_&&a.length>1)u(this,a);else{this.removeAllRanges();for(var b=0,c=a.length;c>b;++b)this.addRange(a[b])}}}else{if(!(E(R,"empty")&&E(S,"select")&&_&&Q))return b.fail("No means of selecting a Range or TextRange was found"),!1;db.removeAllRanges=function(){try{if(this.docSelection.empty(),"None"!=this.docSelection.type){var a;if(this.anchorNode)a=L(this.anchorNode);else if(this.docSelection.type==K){var b=this.docSelection.createRange();b.length&&(a=L(b.item(0)))}if(a){var c=M(a).createTextRange();c.select(),this.docSelection.empty()}}}catch(d){}j(this)},db.addRange=function(b){this.docSelection.type==K?q(this,b):(a.WrappedTextRange.rangeToTextRange(b).select(),this._ranges[0]=b,this.rangeCount=1,this.isCollapsed=this._ranges[0].collapsed,h(this,b,!1))},db.setRanges=function(a){this.removeAllRanges();var b=a.length;b>1?u(this,a):b&&this.addRange(a[0])}}db.getRangeAt=function(a){if(0>a||a>=this.rangeCount)throw new H("INDEX_SIZE_ERR");return this._ranges[a].cloneRange()};var fb;if(Q)fb=function(b){var c;a.isSelectionValid(b.win)?c=b.docSelection.createRange():(c=M(b.win.document).createTextRange(),c.collapse(!0)),b.docSelection.type==K?p(b):n(c)?o(b,c):j(b)};else if(E(R,"getRangeAt")&&typeof R.rangeCount==B)fb=function(b){if(_&&P&&b.docSelection.type==K)p(b);else if(b._ranges.length=b.rangeCount=b.nativeSelection.rangeCount,b.rangeCount){for(var c=0,d=b.rangeCount;d>c;++c)b._ranges[c]=new a.WrappedRange(b.nativeSelection.getRangeAt(c));h(b,b._ranges[b.rangeCount-1],hb(b.nativeSelection)),b.isCollapsed=z(b)}else j(b)};else{if(!U||typeof R.isCollapsed!=A||typeof S.collapsed!=A||!J.implementsDomRange)return b.fail("No means of obtaining a Range or TextRange from the user's selection was found"),!1;fb=function(a){var b,c=a.nativeSelection;c.anchorNode?(b=ab(c,0),a._ranges=[b],a.rangeCount=1,i(a),a.isCollapsed=z(a)):j(a)}}db.refresh=function(a){var b=a?this._ranges.slice(0):null,c=this.anchorNode,d=this.anchorOffset;if(fb(this),a){var e=b.length;if(e!=this._ranges.length)return!0;if(this.anchorNode!=c||this.anchorOffset!=d)return!0;for(;e--;)if(!N(b[e],this._ranges[e]))return!0;return!1}};var gb=function(a,b){var c=a.getAllRanges();a.removeAllRanges();for(var d=0,e=c.length;e>d;++d)N(b,c[d])||a.addRange(c[d]);a.rangeCount||j(a)};db.removeRange=_?function(a){if(this.docSelection.type==K){for(var b,c=this.docSelection.createRange(),d=m(a),e=L(c.item(0)),f=M(e).createControlRange(),g=!1,h=0,i=c.length;i>h;++h)b=c.item(h),b!==d||g?f.add(c.item(h)):g=!0;f.select(),p(this)}else gb(this,a)}:function(a){gb(this,a)};var hb;!Q&&U&&J.implementsDomRange?(hb=g,db.isBackward=function(){return hb(this)}):hb=db.isBackward=function(){return!1},db.isBackwards=db.isBackward,db.toString=function(){for(var a=[],b=0,c=this.rangeCount;c>b;++b)a[b]=""+this._ranges[b];return a.join("")},db.collapse=function(b,c){v(this,b);var d=a.createRange(b);d.collapseToPoint(b,c),this.setSingleRange(d),this.isCollapsed=!0},db.collapseToStart=function(){if(!this.rangeCount)throw new H("INVALID_STATE_ERR");var a=this._ranges[0];this.collapse(a.startContainer,a.startOffset)},db.collapseToEnd=function(){if(!this.rangeCount)throw new H("INVALID_STATE_ERR");var a=this._ranges[this.rangeCount-1];this.collapse(a.endContainer,a.endOffset)},db.selectAllChildren=function(b){v(this,b);var c=a.createRange(b);c.selectNodeContents(b),this.setSingleRange(c)},db.deleteFromDocument=function(){if(_&&P&&this.docSelection.type==K){for(var a,b=this.docSelection.createRange();b.length;)a=b.item(0),b.remove(a),a.parentNode.removeChild(a);this.refresh()}else if(this.rangeCount){var c=this.getAllRanges();if(c.length){this.removeAllRanges();for(var d=0,e=c.length;e>d;++d)c[d].deleteContents();this.addRange(c[e-1])}}},db.eachRange=function(a,b){for(var c=0,d=this._ranges.length;d>c;++c)if(a(this.getRangeAt(c)))return b},db.getAllRanges=function(){var a=[];return this.eachRange(function(b){a.push(b)}),a},db.setSingleRange=function(a,b){this.removeAllRanges(),this.addRange(a,b)},db.callMethodOnEachRange=function(a,b){var c=[];return this.eachRange(function(d){c.push(d[a].apply(d,b))}),c},db.setStart=w(!0),db.setEnd=w(!1),a.rangePrototype.select=function(a){cb(this.getDocument()).setSingleRange(this,a)},db.changeEachRange=function(a){var b=[],c=this.isBackward();this.eachRange(function(c){a(c),b.push(c)}),this.removeAllRanges(),c&&1==b.length?this.addRange(b[0],"backward"):this.setRanges(b)},db.containsNode=function(a,b){return this.eachRange(function(c){return c.containsNode(a,b)},!0)},db.getBookmark=function(a){return{backward:this.isBackward(),rangeBookmarks:this.callMethodOnEachRange("getBookmark",[a])}},db.moveToBookmark=function(b){for(var c,d,e=[],f=0;c=b.rangeBookmarks[f++];)d=a.createRange(this.win),d.moveToBookmark(c),e.push(d);b.backward?this.setSingleRange(e[0],"backward"):this.setRanges(e)},db.toHtml=function(){return this.callMethodOnEachRange("toHtml").join("")},db.getName=function(){return"WrappedSelection"},db.inspect=function(){return x(this)},db.detach=function(){t(this.win,"delete"),s(this)},r.detachAll=function(){t(null,"deleteAll")},r.inspect=x,r.isDirectionBackward=c,a.Selection=r,a.selectionPrototype=db,a.addCreateMissingNativeApiListener(function(a){"undefined"==typeof a.getSelection&&(a.getSelection=function(){return cb(a)}),a=null})})},{"./core":11}]},{},[10])(10)});
//# sourceMappingURL=minislate.min.map